<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Creating a Node Based Editor in Unity | oguzkonya</title>
<link rel="stylesheet" href="/assets/main.css">
<link rel="alternate" type="application/rss+xml" title="oguzkonya" href="/feed.xml">
<script src="/assets/js/jquery.js"></script>
<title>Creating a Node Based Editor in Unity | oguzkonya</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Creating a Node Based Editor in Unity" />
<meta name="author" content="Oguz Konya" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Node based editors are frequently used in game engines; Unity has Animator window, Unreal Engine has blueprint system, some other game engines have dialogue systems. In this blog post, we will create our own node based editor in Unity. It’s going to be simple node editor that you’ll be able to improve upon later (see the below image for an example). I am going to assume that you are already familiar with editor scripting, but if you are not, please take your time to have a look at this post and this post." />
<meta property="og:description" content="Node based editors are frequently used in game engines; Unity has Animator window, Unreal Engine has blueprint system, some other game engines have dialogue systems. In this blog post, we will create our own node based editor in Unity. It’s going to be simple node editor that you’ll be able to improve upon later (see the below image for an example). I am going to assume that you are already familiar with editor scripting, but if you are not, please take your time to have a look at this post and this post." />
<link rel="canonical" href="https://oguzkonya.github.io/creating-node-based-editor-unity/" />
<meta property="og:url" content="https://oguzkonya.github.io/creating-node-based-editor-unity/" />
<meta property="og:site_name" content="oguzkonya" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-15T00:00:00+00:00" />
<script type="application/ld+json">
{"headline":"Creating a Node Based Editor in Unity","dateModified":"2019-08-15T00:00:00+00:00","datePublished":"2019-08-15T00:00:00+00:00","url":"https://oguzkonya.github.io/creating-node-based-editor-unity/","mainEntityOfPage":{"@type":"WebPage","@id":"https://oguzkonya.github.io/creating-node-based-editor-unity/"},"author":{"@type":"Person","name":"Oguz Konya"},"description":"Node based editors are frequently used in game engines; Unity has Animator window, Unreal Engine has blueprint system, some other game engines have dialogue systems. In this blog post, we will create our own node based editor in Unity. It’s going to be simple node editor that you’ll be able to improve upon later (see the below image for an example). I am going to assume that you are already familiar with editor scripting, but if you are not, please take your time to have a look at this post and this post.","@type":"BlogPosting","@context":"https://schema.org"}</script>
</head>
<body data-instant-allow-query-string data-instant-allow-external-links>
<header class="site-header">
 <div class="wrapper-header">
   <div class="header-left">
      <a class="site-title" href="/">oguzkonya</a>
   </div>
   <div class="header-right">
        <a class="page-link" href="/">all&nbsp;posts</a>
        <a class="page-link" href="/categories/">categories</a>
        <a class="page-link" href="/about/">about</a>
   </div>
 </div>
</header>
 <main class="page-content" aria-label="Content">
   <div class="wrapper-content">
     <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
<header class="post-header">
   <h1 class="post-title" itemprop="name headline">Creating a Node Based Editor in Unity</h1>
   <p class="post-meta">
      <time datetime="2019-08-15T00:00:00+00:00" itemprop="datePublished">
        Aug 15, 2019
      </time>
      •
      [
<a href="/category/unity/" rel="category">unity</a>,
<a href="/category/unity-editor/" rel="category">unity-editor</a>
]
      •
      <a href="#disqus_thread" data-disqus-identifier="">0 comments</a>
   </p>
 </header>
 <div class="post-content" itemprop="articleBody">
   <p>Node based editors are frequently used in game engines; Unity has Animator window, Unreal Engine has blueprint system, some other game engines have dialogue systems. In this blog post, we will create our own node based editor in Unity. It’s going to be simple node editor that you’ll be able to improve upon later (see the below image for an example). I am going to assume that you are already familiar with editor scripting, but if you are not, please take your time to have a look at <a href="/creating-editor-windows-in-unity/">this</a> post and <a href="/creating-clone-unitys-console-window/">this</a> post.</p>
<div class="img-wrapper">
    <a target="_blank" rel="noopener noreferrer" href="/assets/img/node-based-editor.gif">
        <img src="/assets/img/node-based-editor.gif" class="center" alt="Window" width="300px" />
    </a>
    <em>We will be creating this window in this post (click to see the gif in action)</em>
</div>
<h3 id="creating-the-window">Creating the Window</h3>
<p>Let’s start by creating a simple editor window. The structure of the code will be similar to that of the console clone we developed in the previous posts: draw the elements first, and then process input, and if the GUI is changed due to input events, force the window to repaint.</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">NodeBasedEditor</span> <span class="p">:</span> <span class="n">EditorWindow</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"Window/Node Based Editor"</span><span class="p">)]</span>
</div><div class="line-8">    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">OpenWindow</span><span class="p">()</span>
</div><div class="line-9">    <span class="p">{</span>
</div><div class="line-10">        <span class="n">NodeBasedEditor</span> <span class="n">window</span> <span class="p">=</span> <span class="n">GetWindow</span><span class="p">&lt;</span><span class="n">NodeBasedEditor</span><span class="p">&gt;();</span>
</div><div class="line-11">        <span class="n">window</span><span class="p">.</span><span class="n">titleContent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Node Based Editor"</span><span class="p">);</span>
</div><div class="line-12">    <span class="p">}</span>
</div><div class="line-13">
</div><div class="line-14">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">()</span>
</div><div class="line-15">    <span class="p">{</span>
</div><div class="line-16">        <span class="nf">DrawNodes</span><span class="p">();</span>
</div><div class="line-17">
</div><div class="line-18">        <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-19">
</div><div class="line-20">        <span class="k">if</span> <span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="n">changed</span><span class="p">)</span> <span class="nf">Repaint</span><span class="p">();</span>
</div><div class="line-21">    <span class="p">}</span>
</div><div class="line-22">
</div><div class="line-23">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawNodes</span><span class="p">()</span>
</div><div class="line-24">    <span class="p">{</span>
</div><div class="line-25">    <span class="p">}</span>
</div><div class="line-26">
</div><div class="line-27">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-28">    <span class="p">{</span>
</div><div class="line-29">    <span class="p">}</span>
</div><div class="line-30"><span class="p">}</span>
</div></code></pre></figure>
<h3 id="drawing-nodes">Drawing Nodes</h3>
<p>Well, since this is a node editor, it should contain a list of nodes, which requires us to define a List<Node>. But first we should define __Node__ class. A __Node__ will be responsible for drawing itself and processing its own events. Unlike __ProcessEvents(Event e)__ in __NodeBasedEditor__, __ProcessEvents(Event e)__ in __Node__ will return a boolean so that we can check whether we should repaint the GUI or not.</Node></p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">Node</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">public</span> <span class="n">Rect</span> <span class="n">rect</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">public</span> <span class="kt">string</span> <span class="n">title</span><span class="p">;</span>
</div><div class="line-9">
</div><div class="line-10">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">style</span><span class="p">;</span>
</div><div class="line-11">
</div><div class="line-12">    <span class="k">public</span> <span class="nf">Node</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">position</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width</span><span class="p">,</span> <span class="kt">float</span> <span class="n">height</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">)</span>
</div><div class="line-13">    <span class="p">{</span>
</div><div class="line-14">        <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
</div><div class="line-15">        <span class="n">style</span> <span class="p">=</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-16">    <span class="p">}</span>
</div><div class="line-17">
</div><div class="line-18">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Drag</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">delta</span><span class="p">)</span>
</div><div class="line-19">    <span class="p">{</span>
</div><div class="line-20">        <span class="n">rect</span><span class="p">.</span><span class="n">position</span> <span class="p">+=</span> <span class="n">delta</span><span class="p">;</span>
</div><div class="line-21">    <span class="p">}</span>
</div><div class="line-22">
</div><div class="line-23">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Draw</span><span class="p">()</span>
</div><div class="line-24">    <span class="p">{</span>
</div><div class="line-25">        <span class="n">GUI</span><span class="p">.</span><span class="nf">Box</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">style</span><span class="p">);</span>
</div><div class="line-26">    <span class="p">}</span>
</div><div class="line-27">
</div><div class="line-28">    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-29">    <span class="p">{</span>
</div><div class="line-30">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-31">    <span class="p">}</span>
</div><div class="line-32"><span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">NodeBasedEditor</span> <span class="p">:</span> <span class="n">EditorWindow</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">nodes</span><span class="p">;</span>
</div><div class="line-8">
</div><div class="line-9">    <span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"Window/Node Based Editor"</span><span class="p">)]</span>
</div><div class="line-10">    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">OpenWindow</span><span class="p">()</span>
</div><div class="line-11">    <span class="p">{</span>
</div><div class="line-12">        <span class="n">NodeBasedEditor</span> <span class="n">window</span> <span class="p">=</span> <span class="n">GetWindow</span><span class="p">&lt;</span><span class="n">NodeBasedEditor</span><span class="p">&gt;();</span>
</div><div class="line-13">        <span class="n">window</span><span class="p">.</span><span class="n">titleContent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Node Based Editor"</span><span class="p">);</span>
</div><div class="line-14">    <span class="p">}</span>
</div><div class="line-15">
</div><div class="line-16">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">()</span>
</div><div class="line-17">    <span class="p">{</span>
</div><div class="line-18">        <span class="nf">DrawNodes</span><span class="p">();</span>
</div><div class="line-19">
</div><div class="line-20">        <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-21">
</div><div class="line-22">        <span class="k">if</span> <span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="n">changed</span><span class="p">)</span> <span class="nf">Repaint</span><span class="p">();</span>
</div><div class="line-23">    <span class="p">}</span>
</div><div class="line-24">
</div><div class="line-25">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawNodes</span><span class="p">()</span>
</div><div class="line-26">    <span class="p">{</span>
</div><div class="line-27">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-28">        <span class="p">{</span>
</div><div class="line-29">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-30">            <span class="p">{</span>
</div><div class="line-31">                <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-32">            <span class="p">}</span>
</div><div class="line-33">        <span class="p">}</span>
</div><div class="line-34">    <span class="p">}</span>
</div><div class="line-35">
</div><div class="line-36">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-37">    <span class="p">{</span>
</div><div class="line-38">    <span class="p">}</span>
</div><div class="line-39"><span class="p">}</span>
</div></code></pre></figure>
<h3 id="creating-nodes">Creating Nodes</h3>
<p>Nodes are drawn in the editor now, but we can’t see them if we don’t create them. We should display a context menu with an “Add node” item when the user right clicks in the editor. When the user clicks “Add node”, we will create a <strong>Node</strong> and add it to the list of nodes, so that it is drawn. A <strong>Node</strong> requires a position, a width, a height and a styling; position will be the mouse’s current position, width will be 200, height will be 50 (yes, I don’t like using magic numbers in code, but this is going to be a simple editor, so the size doesn’t matter for the moment) and we will replicate the Animator window’s node style for styling.</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">NodeBasedEditor</span> <span class="p">:</span> <span class="n">EditorWindow</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">nodes</span><span class="p">;</span>
</div><div class="line-8">
</div><div class="line-9">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-10">
</div><div class="line-11">    <span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"Window/Node Based Editor"</span><span class="p">)]</span>
</div><div class="line-12">    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">OpenWindow</span><span class="p">()</span>
</div><div class="line-13">    <span class="p">{</span>
</div><div class="line-14">        <span class="n">NodeBasedEditor</span> <span class="n">window</span> <span class="p">=</span> <span class="n">GetWindow</span><span class="p">&lt;</span><span class="n">NodeBasedEditor</span><span class="p">&gt;();</span>
</div><div class="line-15">        <span class="n">window</span><span class="p">.</span><span class="n">titleContent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Node Based Editor"</span><span class="p">);</span>
</div><div class="line-16">    <span class="p">}</span>
</div><div class="line-17">
</div><div class="line-18">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnEnable</span><span class="p">()</span>
</div><div class="line-19">    <span class="p">{</span>
</div><div class="line-20">        <span class="n">nodeStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-21">        <span class="n">nodeStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/node1.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-22">        <span class="n">nodeStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-23">    <span class="p">}</span>
</div><div class="line-24">
</div><div class="line-25">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">()</span>
</div><div class="line-26">    <span class="p">{</span>
</div><div class="line-27">        <span class="nf">DrawNodes</span><span class="p">();</span>
</div><div class="line-28">
</div><div class="line-29">        <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-30">
</div><div class="line-31">        <span class="k">if</span> <span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="n">changed</span><span class="p">)</span> <span class="nf">Repaint</span><span class="p">();</span>
</div><div class="line-32">    <span class="p">}</span>
</div><div class="line-33">
</div><div class="line-34">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawNodes</span><span class="p">()</span>
</div><div class="line-35">    <span class="p">{</span>
</div><div class="line-36">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-37">        <span class="p">{</span>
</div><div class="line-38">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-39">            <span class="p">{</span>
</div><div class="line-40">                <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-41">            <span class="p">}</span>
</div><div class="line-42">        <span class="p">}</span>
</div><div class="line-43">    <span class="p">}</span>
</div><div class="line-44">
</div><div class="line-45">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-46">    <span class="p">{</span>
</div><div class="line-47">        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-48">        <span class="p">{</span>
</div><div class="line-49">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">:</span>
</div><div class="line-50">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
</div><div class="line-51">                <span class="p">{</span>
</div><div class="line-52">                    <span class="nf">ProcessContextMenu</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">);</span>
</div><div class="line-53">                <span class="p">}</span>
</div><div class="line-54">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-55">        <span class="p">}</span>
</div><div class="line-56">    <span class="p">}</span>
</div><div class="line-57">
</div><div class="line-58">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessContextMenu</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">mousePosition</span><span class="p">)</span>
</div><div class="line-59">    <span class="p">{</span>
</div><div class="line-60">        <span class="n">GenericMenu</span> <span class="n">genericMenu</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GenericMenu</span><span class="p">();</span>
</div><div class="line-61">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">AddItem</span><span class="p">(</span><span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Add node"</span><span class="p">),</span> <span class="k">false</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nf">OnClickAddNode</span><span class="p">(</span><span class="n">mousePosition</span><span class="p">));</span> 
</div><div class="line-62">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">ShowAsContext</span><span class="p">();</span>
</div><div class="line-63">    <span class="p">}</span>
</div><div class="line-64">
</div><div class="line-65">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickAddNode</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">mousePosition</span><span class="p">)</span>
</div><div class="line-66">    <span class="p">{</span>
</div><div class="line-67">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-68">        <span class="p">{</span>
</div><div class="line-69">            <span class="n">nodes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;();</span>
</div><div class="line-70">        <span class="p">}</span>
</div><div class="line-71">
</div><div class="line-72">        <span class="n">nodes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Node</span><span class="p">(</span><span class="n">mousePosition</span><span class="p">,</span> <span class="m">200</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="n">nodeStyle</span><span class="p">));</span>
</div><div class="line-73">    <span class="p">}</span>
</div><div class="line-74"><span class="p">}</span>
</div></code></pre></figure>
<h3 id="making-nodes-draggable">Making Nodes Draggable</h3>
<p>Alright, now we are able to add nodes, but we can’t drag them around. As I mentioned earlier, nodes will be processing their own events, hence we will be handling drag event in <strong>Node</strong> class. One important thing to note here is that we should be “using” the drag event with <strong>Use()</strong> method. Later on, we will be adding canvas dragging, and we wouldn’t want to drag a node and the whole canvas at the same time (“using” an event prevents it being used by other processes, i.e. it stops event bubbling). Also note that the for loop in <strong>ProcessNodeEvents(Event e)</strong> traverses the node list backwards, because the last node is drawn at the top, so it should process the events first.</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">Node</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">public</span> <span class="n">Rect</span> <span class="n">rect</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">public</span> <span class="kt">string</span> <span class="n">title</span><span class="p">;</span>
</div><div class="line-9">    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isDragged</span><span class="p">;</span>
</div><div class="line-10">
</div><div class="line-11">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">style</span><span class="p">;</span>
</div><div class="line-12">
</div><div class="line-13">    <span class="k">public</span> <span class="nf">Node</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">position</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width</span><span class="p">,</span> <span class="kt">float</span> <span class="n">height</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">)</span>
</div><div class="line-14">    <span class="p">{</span>
</div><div class="line-15">        <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
</div><div class="line-16">        <span class="n">style</span> <span class="p">=</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-17">    <span class="p">}</span>
</div><div class="line-18">
</div><div class="line-19">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Drag</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">delta</span><span class="p">)</span>
</div><div class="line-20">    <span class="p">{</span>
</div><div class="line-21">        <span class="n">rect</span><span class="p">.</span><span class="n">position</span> <span class="p">+=</span> <span class="n">delta</span><span class="p">;</span>
</div><div class="line-22">    <span class="p">}</span>
</div><div class="line-23">
</div><div class="line-24">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Draw</span><span class="p">()</span>
</div><div class="line-25">    <span class="p">{</span>
</div><div class="line-26">        <span class="n">GUI</span><span class="p">.</span><span class="nf">Box</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">style</span><span class="p">);</span>
</div><div class="line-27">    <span class="p">}</span>
</div><div class="line-28">
</div><div class="line-29">    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-30">    <span class="p">{</span>
</div><div class="line-31">        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-32">        <span class="p">{</span>
</div><div class="line-33">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">:</span>
</div><div class="line-34">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</div><div class="line-35">                <span class="p">{</span>
</div><div class="line-36">                    <span class="k">if</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">))</span>
</div><div class="line-37">                    <span class="p">{</span>
</div><div class="line-38">                        <span class="n">isDragged</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-39">                        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-40">                    <span class="p">}</span>
</div><div class="line-41">                    <span class="k">else</span>
</div><div class="line-42">                    <span class="p">{</span>
</div><div class="line-43">                        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-44">                    <span class="p">}</span>
</div><div class="line-45">                <span class="p">}</span>
</div><div class="line-46">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-47">
</div><div class="line-48">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseUp</span><span class="p">:</span>
</div><div class="line-49">                <span class="n">isDragged</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-50">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-51">
</div><div class="line-52">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDrag</span><span class="p">:</span>
</div><div class="line-53">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">isDragged</span><span class="p">)</span>
</div><div class="line-54">                <span class="p">{</span>
</div><div class="line-55">                    <span class="nf">Drag</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">delta</span><span class="p">);</span>
</div><div class="line-56">                    <span class="n">e</span><span class="p">.</span><span class="nf">Use</span><span class="p">();</span>
</div><div class="line-57">                    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-58">                <span class="p">}</span>
</div><div class="line-59">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-60">        <span class="p">}</span>
</div><div class="line-61">
</div><div class="line-62">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-63">    <span class="p">}</span>
</div><div class="line-64"><span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">()</span>
</div><div class="line-2">    <span class="p">{</span>
</div><div class="line-3">        <span class="nf">DrawNodes</span><span class="p">();</span>
</div><div class="line-4">
</div><div class="line-5">        <span class="nf">ProcessNodeEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-6">        <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-7">
</div><div class="line-8">        <span class="k">if</span> <span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="n">changed</span><span class="p">)</span> <span class="nf">Repaint</span><span class="p">();</span>
</div><div class="line-9">    <span class="p">}</span>
</div><div class="line-10">
</div><div class="line-11">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawNodes</span><span class="p">()</span>
</div><div class="line-12">    <span class="p">{</span>
</div><div class="line-13">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-14">        <span class="p">{</span>
</div><div class="line-15">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-16">            <span class="p">{</span>
</div><div class="line-17">                <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-18">            <span class="p">}</span>
</div><div class="line-19">        <span class="p">}</span>
</div><div class="line-20">    <span class="p">}</span>
</div><div class="line-21">
</div><div class="line-22">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-23">    <span class="p">{</span>
</div><div class="line-24">        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-25">        <span class="p">{</span>
</div><div class="line-26">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">:</span>
</div><div class="line-27">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
</div><div class="line-28">                <span class="p">{</span>
</div><div class="line-29">                    <span class="nf">ProcessContextMenu</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">);</span>
</div><div class="line-30">                <span class="p">}</span>
</div><div class="line-31">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-32">        <span class="p">}</span>
</div><div class="line-33">    <span class="p">}</span>
</div><div class="line-34">
</div><div class="line-35">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessNodeEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-36">    <span class="p">{</span>
</div><div class="line-37">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-38">        <span class="p">{</span>
</div><div class="line-39">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="n">nodes</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">--)</span>
</div><div class="line-40">            <span class="p">{</span>
</div><div class="line-41">                <span class="kt">bool</span> <span class="n">guiChanged</span> <span class="p">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</div><div class="line-42">
</div><div class="line-43">                <span class="k">if</span> <span class="p">(</span><span class="n">guiChanged</span><span class="p">)</span>
</div><div class="line-44">                <span class="p">{</span>
</div><div class="line-45">                    <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-46">                <span class="p">}</span>
</div><div class="line-47">            <span class="p">}</span>
</div><div class="line-48">        <span class="p">}</span>
</div><div class="line-49">    <span class="p">}</span>
</div><div class="line-50">	
</div><div class="line-51">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessContextMenu</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">mousePosition</span><span class="p">)</span>
</div><div class="line-52">    <span class="p">{</span>
</div><div class="line-53">        <span class="n">GenericMenu</span> <span class="n">genericMenu</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GenericMenu</span><span class="p">();</span>
</div><div class="line-54">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">AddItem</span><span class="p">(</span><span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Add node"</span><span class="p">),</span> <span class="k">false</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nf">OnClickAddNode</span><span class="p">(</span><span class="n">mousePosition</span><span class="p">));</span> 
</div><div class="line-55">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">ShowAsContext</span><span class="p">();</span>
</div><div class="line-56">    <span class="p">}</span>
</div></code></pre></figure>
<h3 id="creating-connections-between-nodes">Creating Connections Between Nodes</h3>
<p>Our node editor now has nodes, but we should also be able to connect them. In order to do this, we need two connection points (in and out) on a node and a connection between them. A connection point has a rectangle (so that we can draw it), has a type (in or out), has a style and it references its parent node. Therefore, our <strong>ConnectionPoint</strong> class will be a very simple one; drawing a button at a specific position and doing an action when this button is clicked.</p>
<p>On the other hand, a connection has two connection points and an action to remove it. <strong>Connection</strong> class is much simpler than <strong>ConnectionPoint</strong>, however, it introduces a new concept: <strong>Handles</strong>. This class is actually used to draw 3D GUI controls in the <strong>Scene</strong> view, but it is the only class with a bezier drawing method: <strong>Handles.DrawBezier(Vector3, Vector3, Vector3, Vector3, Color, Texture2D, float).</strong> It takes 7 parameters and the first 4 parameters are the position controls (start position, end position, start tangent, and end tangent), while the rest determine how the bezier looks.</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-3">
</div><div class="line-4"><span class="k">public</span> <span class="k">enum</span> <span class="n">ConnectionPointType</span> <span class="p">{</span> <span class="n">In</span><span class="p">,</span> <span class="n">Out</span> <span class="p">}</span>
</div><div class="line-5">
</div><div class="line-6"><span class="k">public</span> <span class="k">class</span> <span class="nc">ConnectionPoint</span>
</div><div class="line-7"><span class="p">{</span>
</div><div class="line-8">    <span class="k">public</span> <span class="n">Rect</span> <span class="n">rect</span><span class="p">;</span>
</div><div class="line-9">
</div><div class="line-10">    <span class="k">public</span> <span class="n">ConnectionPointType</span> <span class="n">type</span><span class="p">;</span>
</div><div class="line-11">
</div><div class="line-12">    <span class="k">public</span> <span class="n">Node</span> <span class="n">node</span><span class="p">;</span>
</div><div class="line-13">
</div><div class="line-14">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">style</span><span class="p">;</span>
</div><div class="line-15">
</div><div class="line-16">    <span class="k">public</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickConnectionPoint</span><span class="p">;</span>
</div><div class="line-17">    
</div><div class="line-18">    <span class="k">public</span> <span class="nf">ConnectionPoint</span><span class="p">(</span><span class="n">Node</span> <span class="n">node</span><span class="p">,</span> <span class="n">ConnectionPointType</span> <span class="n">type</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">style</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickConnectionPoint</span><span class="p">)</span>
</div><div class="line-19">    <span class="p">{</span>
</div><div class="line-20">        <span class="k">this</span><span class="p">.</span><span class="n">node</span> <span class="p">=</span> <span class="n">node</span><span class="p">;</span>
</div><div class="line-21">        <span class="k">this</span><span class="p">.</span><span class="n">type</span> <span class="p">=</span> <span class="n">type</span><span class="p">;</span>
</div><div class="line-22">        <span class="k">this</span><span class="p">.</span><span class="n">style</span> <span class="p">=</span> <span class="n">style</span><span class="p">;</span>
</div><div class="line-23">        <span class="k">this</span><span class="p">.</span><span class="n">OnClickConnectionPoint</span> <span class="p">=</span> <span class="n">OnClickConnectionPoint</span><span class="p">;</span>
</div><div class="line-24">        <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">10f</span><span class="p">,</span> <span class="m">20f</span><span class="p">);</span>
</div><div class="line-25">    <span class="p">}</span>
</div><div class="line-26">
</div><div class="line-27">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Draw</span><span class="p">()</span>
</div><div class="line-28">    <span class="p">{</span>
</div><div class="line-29">        <span class="n">rect</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="n">node</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">height</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">)</span> <span class="p">-</span> <span class="n">rect</span><span class="p">.</span><span class="n">height</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">;</span>
</div><div class="line-30">
</div><div class="line-31">        <span class="k">switch</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-32">        <span class="p">{</span>
</div><div class="line-33">            <span class="k">case</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">In</span><span class="p">:</span>
</div><div class="line-34">                <span class="n">rect</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="n">node</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span> <span class="p">-</span> <span class="n">rect</span><span class="p">.</span><span class="n">width</span> <span class="p">+</span> <span class="m">8f</span><span class="p">;</span>
</div><div class="line-35">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-36">
</div><div class="line-37">            <span class="k">case</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">Out</span><span class="p">:</span>
</div><div class="line-38">                <span class="n">rect</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="n">node</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span> <span class="p">+</span> <span class="n">node</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">width</span> <span class="p">-</span> <span class="m">8f</span><span class="p">;</span>
</div><div class="line-39">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-40">        <span class="p">}</span>
</div><div class="line-41">        
</div><div class="line-42">        <span class="k">if</span> <span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">style</span><span class="p">))</span>
</div><div class="line-43">        <span class="p">{</span>
</div><div class="line-44">            <span class="k">if</span> <span class="p">(</span><span class="n">OnClickConnectionPoint</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-45">            <span class="p">{</span>
</div><div class="line-46">                <span class="nf">OnClickConnectionPoint</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</div><div class="line-47">            <span class="p">}</span>
</div><div class="line-48">        <span class="p">}</span>
</div><div class="line-49">    <span class="p">}</span>
</div><div class="line-50"><span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">Connection</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">inPoint</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">outPoint</span><span class="p">;</span>
</div><div class="line-9">    <span class="k">public</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;</span> <span class="n">OnClickRemoveConnection</span><span class="p">;</span>
</div><div class="line-10">
</div><div class="line-11">    <span class="k">public</span> <span class="nf">Connection</span><span class="p">(</span><span class="n">ConnectionPoint</span> <span class="n">inPoint</span><span class="p">,</span> <span class="n">ConnectionPoint</span> <span class="n">outPoint</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;</span> <span class="n">OnClickRemoveConnection</span><span class="p">)</span>
</div><div class="line-12">    <span class="p">{</span>
</div><div class="line-13">        <span class="k">this</span><span class="p">.</span><span class="n">inPoint</span> <span class="p">=</span> <span class="n">inPoint</span><span class="p">;</span>
</div><div class="line-14">        <span class="k">this</span><span class="p">.</span><span class="n">outPoint</span> <span class="p">=</span> <span class="n">outPoint</span><span class="p">;</span>
</div><div class="line-15">        <span class="k">this</span><span class="p">.</span><span class="n">OnClickRemoveConnection</span> <span class="p">=</span> <span class="n">OnClickRemoveConnection</span><span class="p">;</span>
</div><div class="line-16">    <span class="p">}</span>
</div><div class="line-17">
</div><div class="line-18">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Draw</span><span class="p">()</span>
</div><div class="line-19">    <span class="p">{</span>
</div><div class="line-20">        <span class="n">Handles</span><span class="p">.</span><span class="nf">DrawBezier</span><span class="p">(</span>
</div><div class="line-21">            <span class="n">inPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span><span class="p">,</span>
</div><div class="line-22">            <span class="n">outPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span><span class="p">,</span>
</div><div class="line-23">            <span class="n">inPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-24">            <span class="n">outPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span> <span class="p">-</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-25">            <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span>
</div><div class="line-26">            <span class="k">null</span><span class="p">,</span>
</div><div class="line-27">            <span class="m">2f</span>
</div><div class="line-28">        <span class="p">);</span>
</div><div class="line-29">
</div><div class="line-30">        <span class="k">if</span> <span class="p">(</span><span class="n">Handles</span><span class="p">.</span><span class="nf">Button</span><span class="p">((</span><span class="n">inPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span> <span class="p">+</span> <span class="n">outPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span><span class="p">)</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">.</span><span class="n">identity</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="n">Handles</span><span class="p">.</span><span class="n">RectangleCap</span><span class="p">))</span>
</div><div class="line-31">        <span class="p">{</span>
</div><div class="line-32">            <span class="k">if</span> <span class="p">(</span><span class="n">OnClickRemoveConnection</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-33">            <span class="p">{</span>
</div><div class="line-34">                <span class="nf">OnClickRemoveConnection</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</div><div class="line-35">            <span class="p">}</span>
</div><div class="line-36">        <span class="p">}</span>
</div><div class="line-37">    <span class="p">}</span>
</div><div class="line-38"><span class="p">}</span>
</div></code></pre></figure>
<h3 id="drawing-connections">Drawing Connections</h3>
<p>Since the <strong>Connection</strong> and <strong>ConnectionPoint</strong> classes are ready, all we have to do is draw connection points in <strong>Node</strong> class and draw connections in <strong>NodeBasedEditor</strong>. Changes in <strong>Node</strong> class will be minimal; we will define two connection points, modify the constructor so that we can pass the styling and actions for them, and draw them in <strong>Draw()</strong> method.</p>
<p>However, <strong>NodeBasedEditor</strong> needs significant modification. First of all, we need to define styles for connection points. You can use a single style for both of them, but I would like them to look different, so I will be using separate styles for each. We are going to initialize these styles in <strong>OnEnable()</strong> just like we initialized node style.</p>
<p>Secondly, we need to keep track of clicked connection points, so that when a user selects an <strong>in</strong> and <strong>out</strong>, we should create a connection between them. This step includes most of the additions:</p>
<ul>
 <li>OnClickInPoint(ConnectionPoint) handles clicking an <strong>in</strong> point.</li>
 <li>OnClickOutPoint(ConnectionPoint) handles clicking an <strong>out</strong> point.</li>
 <li>OnClickRemoveConnection(Connection) handles clicking the remove button on connections.</li>
 <li>CreateConnection() creates a connection when an <strong>in</strong> and an <strong>out</strong> point is selected.</li>
 <li>ClearConnectionSelection() clears selected points.</li>
</ul>
<p>And lastly, we need to draw connections in <strong>OnGUI()</strong> just like we draw nodes.</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">Node</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">public</span> <span class="n">Rect</span> <span class="n">rect</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">public</span> <span class="kt">string</span> <span class="n">title</span><span class="p">;</span>
</div><div class="line-9">    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isDragged</span><span class="p">;</span>
</div><div class="line-10">
</div><div class="line-11">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">inPoint</span><span class="p">;</span>
</div><div class="line-12">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">outPoint</span><span class="p">;</span>
</div><div class="line-13">
</div><div class="line-14">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">style</span><span class="p">;</span>
</div><div class="line-15">
</div><div class="line-16">    <span class="k">public</span> <span class="nf">Node</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">position</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width</span><span class="p">,</span> <span class="kt">float</span> <span class="n">height</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickInPoint</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickOutPoint</span><span class="p">)</span>
</div><div class="line-17">    <span class="p">{</span>
</div><div class="line-18">        <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
</div><div class="line-19">        <span class="n">style</span> <span class="p">=</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-20">        <span class="n">inPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionPoint</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">In</span><span class="p">,</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">OnClickInPoint</span><span class="p">);</span>
</div><div class="line-21">        <span class="n">outPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionPoint</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">Out</span><span class="p">,</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">OnClickOutPoint</span><span class="p">);</span>
</div><div class="line-22">    <span class="p">}</span>
</div><div class="line-23">
</div><div class="line-24">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Drag</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">delta</span><span class="p">)</span>
</div><div class="line-25">    <span class="p">{</span>
</div><div class="line-26">        <span class="n">rect</span><span class="p">.</span><span class="n">position</span> <span class="p">+=</span> <span class="n">delta</span><span class="p">;</span>
</div><div class="line-27">    <span class="p">}</span>
</div><div class="line-28">
</div><div class="line-29">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Draw</span><span class="p">()</span>
</div><div class="line-30">    <span class="p">{</span>
</div><div class="line-31">        <span class="n">inPoint</span><span class="p">.</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-32">        <span class="n">outPoint</span><span class="p">.</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-33">        <span class="n">GUI</span><span class="p">.</span><span class="nf">Box</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">style</span><span class="p">);</span>
</div><div class="line-34">    <span class="p">}</span>
</div><div class="line-35">
</div><div class="line-36">    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-37">    <span class="p">{</span>
</div><div class="line-38">        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-39">        <span class="p">{</span>
</div><div class="line-40">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">:</span>
</div><div class="line-41">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</div><div class="line-42">                <span class="p">{</span>
</div><div class="line-43">                    <span class="k">if</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">))</span>
</div><div class="line-44">                    <span class="p">{</span>
</div><div class="line-45">                        <span class="n">isDragged</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-46">                        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-47">                    <span class="p">}</span>
</div><div class="line-48">                    <span class="k">else</span>
</div><div class="line-49">                    <span class="p">{</span>
</div><div class="line-50">                        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-51">                    <span class="p">}</span>
</div><div class="line-52">                <span class="p">}</span>
</div><div class="line-53">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-54">
</div><div class="line-55">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseUp</span><span class="p">:</span>
</div><div class="line-56">                <span class="n">isDragged</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-57">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-58">
</div><div class="line-59">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDrag</span><span class="p">:</span>
</div><div class="line-60">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">isDragged</span><span class="p">)</span>
</div><div class="line-61">                <span class="p">{</span>
</div><div class="line-62">                    <span class="nf">Drag</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">delta</span><span class="p">);</span>
</div><div class="line-63">                    <span class="n">e</span><span class="p">.</span><span class="nf">Use</span><span class="p">();</span>
</div><div class="line-64">                    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-65">                <span class="p">}</span>
</div><div class="line-66">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-67">        <span class="p">}</span>
</div><div class="line-68">
</div><div class="line-69">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-70">    <span class="p">}</span>
</div><div class="line-71"><span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">NodeBasedEditor</span> <span class="p">:</span> <span class="n">EditorWindow</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">nodes</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;</span> <span class="n">connections</span><span class="p">;</span>
</div><div class="line-9">
</div><div class="line-10">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-11">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">inPointStyle</span><span class="p">;</span>
</div><div class="line-12">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">outPointStyle</span><span class="p">;</span>
</div><div class="line-13">
</div><div class="line-14">    <span class="k">private</span> <span class="n">ConnectionPoint</span> <span class="n">selectedInPoint</span><span class="p">;</span>
</div><div class="line-15">    <span class="k">private</span> <span class="n">ConnectionPoint</span> <span class="n">selectedOutPoint</span><span class="p">;</span>
</div><div class="line-16">
</div><div class="line-17">    <span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"Window/Node Based Editor"</span><span class="p">)]</span>
</div><div class="line-18">    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">OpenWindow</span><span class="p">()</span>
</div><div class="line-19">    <span class="p">{</span>
</div><div class="line-20">        <span class="n">NodeBasedEditor</span> <span class="n">window</span> <span class="p">=</span> <span class="n">GetWindow</span><span class="p">&lt;</span><span class="n">NodeBasedEditor</span><span class="p">&gt;();</span>
</div><div class="line-21">        <span class="n">window</span><span class="p">.</span><span class="n">titleContent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Node Based Editor"</span><span class="p">);</span>
</div><div class="line-22">    <span class="p">}</span>
</div><div class="line-23">
</div><div class="line-24">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnEnable</span><span class="p">()</span>
</div><div class="line-25">    <span class="p">{</span>
</div><div class="line-26">        <span class="n">nodeStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-27">        <span class="n">nodeStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/node1.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-28">        <span class="n">nodeStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-29">		
</div><div class="line-30">        <span class="n">inPointStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-31">        <span class="n">inPointStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn left.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-32">        <span class="n">inPointStyle</span><span class="p">.</span><span class="n">active</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn left on.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-33">        <span class="n">inPointStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-34">
</div><div class="line-35">        <span class="n">outPointStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-36">        <span class="n">outPointStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn right.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-37">        <span class="n">outPointStyle</span><span class="p">.</span><span class="n">active</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn right on.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-38">        <span class="n">outPointStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-39">    <span class="p">}</span>
</div><div class="line-40">
</div><div class="line-41">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">()</span>
</div><div class="line-42">    <span class="p">{</span>
</div><div class="line-43">        <span class="nf">DrawNodes</span><span class="p">();</span>
</div><div class="line-44">        <span class="nf">DrawConnections</span><span class="p">();</span>
</div><div class="line-45">
</div><div class="line-46">        <span class="nf">ProcessNodeEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-47">        <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-48">
</div><div class="line-49">        <span class="k">if</span> <span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="n">changed</span><span class="p">)</span> <span class="nf">Repaint</span><span class="p">();</span>
</div><div class="line-50">    <span class="p">}</span>
</div><div class="line-51">
</div><div class="line-52">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawNodes</span><span class="p">()</span>
</div><div class="line-53">    <span class="p">{</span>
</div><div class="line-54">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-55">        <span class="p">{</span>
</div><div class="line-56">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-57">            <span class="p">{</span>
</div><div class="line-58">                <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-59">            <span class="p">}</span>
</div><div class="line-60">        <span class="p">}</span>
</div><div class="line-61">    <span class="p">}</span>
</div><div class="line-62">
</div><div class="line-63">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawConnections</span><span class="p">()</span>
</div><div class="line-64">    <span class="p">{</span>
</div><div class="line-65">        <span class="k">if</span> <span class="p">(</span><span class="n">connections</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-66">        <span class="p">{</span>
</div><div class="line-67">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">connections</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-68">            <span class="p">{</span>
</div><div class="line-69">                <span class="n">connections</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-70">            <span class="p">}</span> 
</div><div class="line-71">        <span class="p">}</span>
</div><div class="line-72">    <span class="p">}</span>
</div><div class="line-73">
</div><div class="line-74">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-75">    <span class="p">{</span>
</div><div class="line-76">        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-77">        <span class="p">{</span>
</div><div class="line-78">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">:</span>
</div><div class="line-79">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</div><div class="line-80">                <span class="p">{</span>
</div><div class="line-81">                    <span class="nf">ClearConnectionSelection</span><span class="p">();</span>
</div><div class="line-82">                <span class="p">}</span>
</div><div class="line-83">
</div><div class="line-84">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
</div><div class="line-85">                <span class="p">{</span>
</div><div class="line-86">                    <span class="nf">ProcessContextMenu</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">);</span>
</div><div class="line-87">                <span class="p">}</span>
</div><div class="line-88">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-89">        <span class="p">}</span>
</div><div class="line-90">    <span class="p">}</span>
</div><div class="line-91">
</div><div class="line-92">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessNodeEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-93">    <span class="p">{</span>
</div><div class="line-94">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-95">        <span class="p">{</span>
</div><div class="line-96">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="n">nodes</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">--)</span>
</div><div class="line-97">            <span class="p">{</span>
</div><div class="line-98">                <span class="kt">bool</span> <span class="n">guiChanged</span> <span class="p">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</div><div class="line-99">
</div><div class="line-100">                <span class="k">if</span> <span class="p">(</span><span class="n">guiChanged</span><span class="p">)</span>
</div><div class="line-101">                <span class="p">{</span>
</div><div class="line-102">                    <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-103">                <span class="p">}</span>
</div><div class="line-104">            <span class="p">}</span>
</div><div class="line-105">        <span class="p">}</span>
</div><div class="line-106">    <span class="p">}</span>
</div><div class="line-107">	
</div><div class="line-108">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessContextMenu</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">mousePosition</span><span class="p">)</span>
</div><div class="line-109">    <span class="p">{</span>
</div><div class="line-110">        <span class="n">GenericMenu</span> <span class="n">genericMenu</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GenericMenu</span><span class="p">();</span>
</div><div class="line-111">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">AddItem</span><span class="p">(</span><span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Add node"</span><span class="p">),</span> <span class="k">false</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nf">OnClickAddNode</span><span class="p">(</span><span class="n">mousePosition</span><span class="p">));</span> 
</div><div class="line-112">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">ShowAsContext</span><span class="p">();</span>
</div><div class="line-113">    <span class="p">}</span>
</div><div class="line-114">
</div><div class="line-115">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickAddNode</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">mousePosition</span><span class="p">)</span>
</div><div class="line-116">    <span class="p">{</span>
</div><div class="line-117">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-118">        <span class="p">{</span>
</div><div class="line-119">            <span class="n">nodes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;();</span>
</div><div class="line-120">        <span class="p">}</span>
</div><div class="line-121">
</div><div class="line-122">        <span class="n">nodes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Node</span><span class="p">(</span><span class="n">mousePosition</span><span class="p">,</span> <span class="m">200</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="n">nodeStyle</span><span class="p">,</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">OnClickInPoint</span><span class="p">,</span> <span class="n">OnClickOutPoint</span><span class="p">));</span>
</div><div class="line-123">    <span class="p">}</span>
</div><div class="line-124">
</div><div class="line-125">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickInPoint</span><span class="p">(</span><span class="n">ConnectionPoint</span> <span class="n">inPoint</span><span class="p">)</span>
</div><div class="line-126">    <span class="p">{</span>
</div><div class="line-127">        <span class="n">selectedInPoint</span> <span class="p">=</span> <span class="n">inPoint</span><span class="p">;</span>
</div><div class="line-128">
</div><div class="line-129">        <span class="k">if</span> <span class="p">(</span><span class="n">selectedOutPoint</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-130">        <span class="p">{</span>
</div><div class="line-131">            <span class="k">if</span> <span class="p">(</span><span class="n">selectedOutPoint</span><span class="p">.</span><span class="n">node</span> <span class="p">!=</span> <span class="n">selectedInPoint</span><span class="p">.</span><span class="n">node</span><span class="p">)</span>
</div><div class="line-132">            <span class="p">{</span>
</div><div class="line-133">                <span class="nf">CreateConnection</span><span class="p">();</span>
</div><div class="line-134">                <span class="nf">ClearConnectionSelection</span><span class="p">();</span> 
</div><div class="line-135">            <span class="p">}</span>
</div><div class="line-136">            <span class="k">else</span>
</div><div class="line-137">            <span class="p">{</span>
</div><div class="line-138">                <span class="nf">ClearConnectionSelection</span><span class="p">();</span>
</div><div class="line-139">            <span class="p">}</span>
</div><div class="line-140">        <span class="p">}</span>
</div><div class="line-141">    <span class="p">}</span>
</div><div class="line-142">
</div><div class="line-143">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickOutPoint</span><span class="p">(</span><span class="n">ConnectionPoint</span> <span class="n">outPoint</span><span class="p">)</span>
</div><div class="line-144">    <span class="p">{</span>
</div><div class="line-145">        <span class="n">selectedOutPoint</span> <span class="p">=</span> <span class="n">outPoint</span><span class="p">;</span>
</div><div class="line-146">
</div><div class="line-147">        <span class="k">if</span> <span class="p">(</span><span class="n">selectedInPoint</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-148">        <span class="p">{</span>
</div><div class="line-149">            <span class="k">if</span> <span class="p">(</span><span class="n">selectedOutPoint</span><span class="p">.</span><span class="n">node</span> <span class="p">!=</span> <span class="n">selectedInPoint</span><span class="p">.</span><span class="n">node</span><span class="p">)</span>
</div><div class="line-150">            <span class="p">{</span>
</div><div class="line-151">                <span class="nf">CreateConnection</span><span class="p">();</span>
</div><div class="line-152">                <span class="nf">ClearConnectionSelection</span><span class="p">();</span>
</div><div class="line-153">            <span class="p">}</span>
</div><div class="line-154">            <span class="k">else</span>
</div><div class="line-155">            <span class="p">{</span>
</div><div class="line-156">                <span class="nf">ClearConnectionSelection</span><span class="p">();</span>
</div><div class="line-157">            <span class="p">}</span>
</div><div class="line-158">        <span class="p">}</span>
</div><div class="line-159">    <span class="p">}</span>
</div><div class="line-160">
</div><div class="line-161">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickRemoveConnection</span><span class="p">(</span><span class="n">Connection</span> <span class="n">connection</span><span class="p">)</span>
</div><div class="line-162">    <span class="p">{</span>
</div><div class="line-163">        <span class="n">connections</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">connection</span><span class="p">);</span>
</div><div class="line-164">    <span class="p">}</span>
</div><div class="line-165">
</div><div class="line-166">    <span class="k">private</span> <span class="k">void</span> <span class="nf">CreateConnection</span><span class="p">()</span>
</div><div class="line-167">    <span class="p">{</span>
</div><div class="line-168">        <span class="k">if</span> <span class="p">(</span><span class="n">connections</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-169">        <span class="p">{</span>
</div><div class="line-170">            <span class="n">connections</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;();</span>
</div><div class="line-171">        <span class="p">}</span>
</div><div class="line-172">
</div><div class="line-173">        <span class="n">connections</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Connection</span><span class="p">(</span><span class="n">selectedInPoint</span><span class="p">,</span> <span class="n">selectedOutPoint</span><span class="p">,</span> <span class="n">OnClickRemoveConnection</span><span class="p">));</span>
</div><div class="line-174">    <span class="p">}</span>
</div><div class="line-175">
</div><div class="line-176">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ClearConnectionSelection</span><span class="p">()</span>
</div><div class="line-177">    <span class="p">{</span>
</div><div class="line-178">        <span class="n">selectedInPoint</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</div><div class="line-179">        <span class="n">selectedOutPoint</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</div><div class="line-180">    <span class="p">}</span>
</div><div class="line-181"><span class="p">}</span>
</div></code></pre></figure>
<h3 id="selecting-nodes">Selecting Nodes</h3>
<p>We should provide feedback when the user clicks on a node so that they would know which node they selected (or if a node is selected at all). This is going to be useful when a user wants to remove a node.</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">Node</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">public</span> <span class="n">Rect</span> <span class="n">rect</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">public</span> <span class="kt">string</span> <span class="n">title</span><span class="p">;</span>
</div><div class="line-9">    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isDragged</span><span class="p">;</span>
</div><div class="line-10">    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isSelected</span><span class="p">;</span>
</div><div class="line-11">
</div><div class="line-12">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">inPoint</span><span class="p">;</span>
</div><div class="line-13">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">outPoint</span><span class="p">;</span>
</div><div class="line-14">
</div><div class="line-15">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">style</span><span class="p">;</span>
</div><div class="line-16">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">defaultNodeStyle</span><span class="p">;</span>
</div><div class="line-17">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">selectedNodeStyle</span><span class="p">;</span>
</div><div class="line-18">
</div><div class="line-19">    <span class="k">public</span> <span class="nf">Node</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">position</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width</span><span class="p">,</span> <span class="kt">float</span> <span class="n">height</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">selectedStyle</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickInPoint</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickOutPoint</span><span class="p">)</span>
</div><div class="line-20">    <span class="p">{</span>
</div><div class="line-21">        <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
</div><div class="line-22">        <span class="n">style</span> <span class="p">=</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-23">        <span class="n">inPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionPoint</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">In</span><span class="p">,</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">OnClickInPoint</span><span class="p">);</span>
</div><div class="line-24">        <span class="n">outPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionPoint</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">Out</span><span class="p">,</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">OnClickOutPoint</span><span class="p">);</span>
</div><div class="line-25">        <span class="n">defaultNodeStyle</span> <span class="p">=</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-26">        <span class="n">selectedNodeStyle</span> <span class="p">=</span> <span class="n">selectedStyle</span><span class="p">;</span>
</div><div class="line-27">    <span class="p">}</span>
</div><div class="line-28">
</div><div class="line-29">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Drag</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">delta</span><span class="p">)</span>
</div><div class="line-30">    <span class="p">{</span>
</div><div class="line-31">        <span class="n">rect</span><span class="p">.</span><span class="n">position</span> <span class="p">+=</span> <span class="n">delta</span><span class="p">;</span>
</div><div class="line-32">    <span class="p">}</span>
</div><div class="line-33">
</div><div class="line-34">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Draw</span><span class="p">()</span>
</div><div class="line-35">    <span class="p">{</span>
</div><div class="line-36">        <span class="n">inPoint</span><span class="p">.</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-37">        <span class="n">outPoint</span><span class="p">.</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-38">        <span class="n">GUI</span><span class="p">.</span><span class="nf">Box</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">style</span><span class="p">);</span>
</div><div class="line-39">    <span class="p">}</span>
</div><div class="line-40">
</div><div class="line-41">    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-42">    <span class="p">{</span>
</div><div class="line-43">        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-44">        <span class="p">{</span>
</div><div class="line-45">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">:</span>
</div><div class="line-46">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</div><div class="line-47">                <span class="p">{</span>
</div><div class="line-48">                    <span class="k">if</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">))</span>
</div><div class="line-49">                    <span class="p">{</span>
</div><div class="line-50">                        <span class="n">isDragged</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-51">                        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-52">                        <span class="n">isSelected</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-53">                        <span class="n">style</span> <span class="p">=</span> <span class="n">selectedNodeStyle</span><span class="p">;</span>
</div><div class="line-54">                    <span class="p">}</span>
</div><div class="line-55">                    <span class="k">else</span>
</div><div class="line-56">                    <span class="p">{</span>
</div><div class="line-57">                        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-58">                        <span class="n">isSelected</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-59">                        <span class="n">style</span> <span class="p">=</span> <span class="n">defaultNodeStyle</span><span class="p">;</span>
</div><div class="line-60">                    <span class="p">}</span>
</div><div class="line-61">                <span class="p">}</span>
</div><div class="line-62">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-63">
</div><div class="line-64">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseUp</span><span class="p">:</span>
</div><div class="line-65">                <span class="n">isDragged</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-66">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-67">
</div><div class="line-68">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDrag</span><span class="p">:</span>
</div><div class="line-69">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">isDragged</span><span class="p">)</span>
</div><div class="line-70">                <span class="p">{</span>
</div><div class="line-71">                    <span class="nf">Drag</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">delta</span><span class="p">);</span>
</div><div class="line-72">                    <span class="n">e</span><span class="p">.</span><span class="nf">Use</span><span class="p">();</span>
</div><div class="line-73">                    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-74">                <span class="p">}</span>
</div><div class="line-75">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-76">        <span class="p">}</span>
</div><div class="line-77">
</div><div class="line-78">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-79">    <span class="p">}</span>
</div><div class="line-80"><span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">NodeBasedEditor</span> <span class="p">:</span> <span class="n">EditorWindow</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">nodes</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;</span> <span class="n">connections</span><span class="p">;</span>
</div><div class="line-9">
</div><div class="line-10">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-11">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">selectedNodeStyle</span><span class="p">;</span>
</div><div class="line-12">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">inPointStyle</span><span class="p">;</span>
</div><div class="line-13">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">outPointStyle</span><span class="p">;</span>
</div><div class="line-14">
</div><div class="line-15">    <span class="k">private</span> <span class="n">ConnectionPoint</span> <span class="n">selectedInPoint</span><span class="p">;</span>
</div><div class="line-16">    <span class="k">private</span> <span class="n">ConnectionPoint</span> <span class="n">selectedOutPoint</span><span class="p">;</span>
</div><div class="line-17">
</div><div class="line-18">    <span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"Window/Node Based Editor"</span><span class="p">)]</span>
</div><div class="line-19">    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">OpenWindow</span><span class="p">()</span>
</div><div class="line-20">    <span class="p">{</span>
</div><div class="line-21">        <span class="n">NodeBasedEditor</span> <span class="n">window</span> <span class="p">=</span> <span class="n">GetWindow</span><span class="p">&lt;</span><span class="n">NodeBasedEditor</span><span class="p">&gt;();</span>
</div><div class="line-22">        <span class="n">window</span><span class="p">.</span><span class="n">titleContent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Node Based Editor"</span><span class="p">);</span>
</div><div class="line-23">    <span class="p">}</span>
</div><div class="line-24">
</div><div class="line-25">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnEnable</span><span class="p">()</span>
</div><div class="line-26">    <span class="p">{</span>
</div><div class="line-27">        <span class="n">nodeStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-28">        <span class="n">nodeStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/node1.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-29">        <span class="n">nodeStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-30">
</div><div class="line-31">        <span class="n">selectedNodeStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-32">        <span class="n">selectedNodeStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/node1 on.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-33">        <span class="n">selectedNodeStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-34">
</div><div class="line-35">        <span class="n">inPointStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-36">        <span class="n">inPointStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn left.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-37">        <span class="n">inPointStyle</span><span class="p">.</span><span class="n">active</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn left on.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-38">        <span class="n">inPointStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-39">
</div><div class="line-40">        <span class="n">outPointStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-41">        <span class="n">outPointStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn right.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-42">        <span class="n">outPointStyle</span><span class="p">.</span><span class="n">active</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn right on.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-43">        <span class="n">outPointStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-44">    <span class="p">}</span>
</div><div class="line-45">
</div><div class="line-46">    <span class="p">...</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickAddNode</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">mousePosition</span><span class="p">)</span>
</div><div class="line-2">    <span class="p">{</span>
</div><div class="line-3">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-4">        <span class="p">{</span>
</div><div class="line-5">            <span class="n">nodes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;();</span>
</div><div class="line-6">        <span class="p">}</span>
</div><div class="line-7">
</div><div class="line-8">        <span class="n">nodes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Node</span><span class="p">(</span><span class="n">mousePosition</span><span class="p">,</span> <span class="m">200</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="n">nodeStyle</span><span class="p">,</span> <span class="n">selectedNodeStyle</span><span class="p">,</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">OnClickInPoint</span><span class="p">,</span> <span class="n">OnClickOutPoint</span><span class="p">));</span>
</div><div class="line-9">    <span class="p">}</span>
</div></code></pre></figure>
<h3 id="removing-nodes">Removing Nodes</h3>
<p>Some node editors prefer to put the <strong>remove node</strong> button on the node itself, but in our case it might be dangerous: the user might remove a node accidentally. So, we are going to do the next best thing: put that button on a context menu. Users should select the node first and then right click on it in order to access the <strong>remove node</strong> button. When the user clicks <strong>remove node</strong>, we will remove the node from the nodes list. However, the node might have connections to other nodes, so we should remove those connections first.</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">Node</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">public</span> <span class="n">Rect</span> <span class="n">rect</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">public</span> <span class="kt">string</span> <span class="n">title</span><span class="p">;</span>
</div><div class="line-9">    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isDragged</span><span class="p">;</span>
</div><div class="line-10">    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isSelected</span><span class="p">;</span>
</div><div class="line-11">
</div><div class="line-12">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">inPoint</span><span class="p">;</span>
</div><div class="line-13">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">outPoint</span><span class="p">;</span>
</div><div class="line-14">
</div><div class="line-15">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">style</span><span class="p">;</span>
</div><div class="line-16">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">defaultNodeStyle</span><span class="p">;</span>
</div><div class="line-17">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">selectedNodeStyle</span><span class="p">;</span>
</div><div class="line-18">
</div><div class="line-19">    <span class="k">public</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">OnRemoveNode</span><span class="p">;</span>
</div><div class="line-20">
</div><div class="line-21">    <span class="k">public</span> <span class="nf">Node</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">position</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width</span><span class="p">,</span> <span class="kt">float</span> <span class="n">height</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">selectedStyle</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickInPoint</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickOutPoint</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">OnClickRemoveNode</span><span class="p">)</span>
</div><div class="line-22">    <span class="p">{</span>
</div><div class="line-23">        <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
</div><div class="line-24">        <span class="n">style</span> <span class="p">=</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-25">        <span class="n">inPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionPoint</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">In</span><span class="p">,</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">OnClickInPoint</span><span class="p">);</span>
</div><div class="line-26">        <span class="n">outPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionPoint</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">Out</span><span class="p">,</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">OnClickOutPoint</span><span class="p">);</span>
</div><div class="line-27">        <span class="n">defaultNodeStyle</span> <span class="p">=</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-28">        <span class="n">selectedNodeStyle</span> <span class="p">=</span> <span class="n">selectedStyle</span><span class="p">;</span>
</div><div class="line-29">        <span class="n">OnRemoveNode</span> <span class="p">=</span> <span class="n">OnClickRemoveNode</span><span class="p">;</span>
</div><div class="line-30">    <span class="p">}</span>
</div><div class="line-31">
</div><div class="line-32">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Drag</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">delta</span><span class="p">)</span>
</div><div class="line-33">    <span class="p">{</span>
</div><div class="line-34">        <span class="n">rect</span><span class="p">.</span><span class="n">position</span> <span class="p">+=</span> <span class="n">delta</span><span class="p">;</span>
</div><div class="line-35">    <span class="p">}</span>
</div><div class="line-36">
</div><div class="line-37">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Draw</span><span class="p">()</span>
</div><div class="line-38">    <span class="p">{</span>
</div><div class="line-39">        <span class="n">inPoint</span><span class="p">.</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-40">        <span class="n">outPoint</span><span class="p">.</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-41">        <span class="n">GUI</span><span class="p">.</span><span class="nf">Box</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">style</span><span class="p">);</span>
</div><div class="line-42">    <span class="p">}</span>
</div><div class="line-43">
</div><div class="line-44">    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-45">    <span class="p">{</span>
</div><div class="line-46">        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-47">        <span class="p">{</span>
</div><div class="line-48">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">:</span>
</div><div class="line-49">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</div><div class="line-50">                <span class="p">{</span>
</div><div class="line-51">                    <span class="k">if</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">))</span>
</div><div class="line-52">                    <span class="p">{</span>
</div><div class="line-53">                        <span class="n">isDragged</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-54">                        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-55">                        <span class="n">isSelected</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-56">                        <span class="n">style</span> <span class="p">=</span> <span class="n">selectedNodeStyle</span><span class="p">;</span>
</div><div class="line-57">                    <span class="p">}</span>
</div><div class="line-58">                    <span class="k">else</span>
</div><div class="line-59">                    <span class="p">{</span>
</div><div class="line-60">                        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-61">                        <span class="n">isSelected</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-62">                        <span class="n">style</span> <span class="p">=</span> <span class="n">defaultNodeStyle</span><span class="p">;</span>
</div><div class="line-63">                    <span class="p">}</span>
</div><div class="line-64">                <span class="p">}</span>
</div><div class="line-65">
</div><div class="line-66">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">1</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">isSelected</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">rect</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">))</span>
</div><div class="line-67">                <span class="p">{</span>
</div><div class="line-68">                    <span class="nf">ProcessContextMenu</span><span class="p">();</span>
</div><div class="line-69">                    <span class="n">e</span><span class="p">.</span><span class="nf">Use</span><span class="p">();</span>
</div><div class="line-70">                <span class="p">}</span>
</div><div class="line-71">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-72">
</div><div class="line-73">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseUp</span><span class="p">:</span>
</div><div class="line-74">                <span class="n">isDragged</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-75">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-76">
</div><div class="line-77">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDrag</span><span class="p">:</span>
</div><div class="line-78">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">isDragged</span><span class="p">)</span>
</div><div class="line-79">                <span class="p">{</span>
</div><div class="line-80">                    <span class="nf">Drag</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">delta</span><span class="p">);</span>
</div><div class="line-81">                    <span class="n">e</span><span class="p">.</span><span class="nf">Use</span><span class="p">();</span>
</div><div class="line-82">                    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-83">                <span class="p">}</span>
</div><div class="line-84">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-85">        <span class="p">}</span>
</div><div class="line-86">
</div><div class="line-87">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-88">    <span class="p">}</span>
</div><div class="line-89">
</div><div class="line-90">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessContextMenu</span><span class="p">()</span>
</div><div class="line-91">    <span class="p">{</span>
</div><div class="line-92">        <span class="n">GenericMenu</span> <span class="n">genericMenu</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GenericMenu</span><span class="p">();</span>
</div><div class="line-93">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">AddItem</span><span class="p">(</span><span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Remove node"</span><span class="p">),</span> <span class="k">false</span><span class="p">,</span> <span class="n">OnClickRemoveNode</span><span class="p">);</span>
</div><div class="line-94">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">ShowAsContext</span><span class="p">();</span>
</div><div class="line-95">    <span class="p">}</span>
</div><div class="line-96">
</div><div class="line-97">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickRemoveNode</span><span class="p">()</span>
</div><div class="line-98">    <span class="p">{</span>
</div><div class="line-99">        <span class="k">if</span> <span class="p">(</span><span class="n">OnRemoveNode</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-100">        <span class="p">{</span>
</div><div class="line-101">            <span class="nf">OnRemoveNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</div><div class="line-102">        <span class="p">}</span>
</div><div class="line-103">    <span class="p">}</span>
</div><div class="line-104"><span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickAddNode</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">mousePosition</span><span class="p">)</span>
</div><div class="line-2">    <span class="p">{</span>
</div><div class="line-3">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-4">        <span class="p">{</span>
</div><div class="line-5">            <span class="n">nodes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;();</span>
</div><div class="line-6">        <span class="p">}</span>
</div><div class="line-7">
</div><div class="line-8">        <span class="n">nodes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Node</span><span class="p">(</span><span class="n">mousePosition</span><span class="p">,</span> <span class="m">200</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="n">nodeStyle</span><span class="p">,</span> <span class="n">selectedNodeStyle</span><span class="p">,</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">OnClickInPoint</span><span class="p">,</span> <span class="n">OnClickOutPoint</span><span class="p">,</span> <span class="n">OnClickRemoveNode</span><span class="p">));</span>
</div><div class="line-9">    <span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickRemoveNode</span><span class="p">(</span><span class="n">Node</span> <span class="n">node</span><span class="p">)</span>
</div><div class="line-2">    <span class="p">{</span>
</div><div class="line-3">        <span class="k">if</span> <span class="p">(</span><span class="n">connections</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-4">        <span class="p">{</span>
</div><div class="line-5">            <span class="n">List</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;</span> <span class="n">connectionsToRemove</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;();</span>
</div><div class="line-6">
</div><div class="line-7">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">connections</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-8">            <span class="p">{</span>
</div><div class="line-9">                <span class="k">if</span> <span class="p">(</span><span class="n">connections</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">inPoint</span> <span class="p">==</span> <span class="n">node</span><span class="p">.</span><span class="n">inPoint</span> <span class="p">||</span> <span class="n">connections</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">outPoint</span> <span class="p">==</span> <span class="n">node</span><span class="p">.</span><span class="n">outPoint</span><span class="p">)</span>
</div><div class="line-10">                <span class="p">{</span>
</div><div class="line-11">                    <span class="n">connectionsToRemove</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">connections</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</div><div class="line-12">                <span class="p">}</span>
</div><div class="line-13">            <span class="p">}</span>
</div><div class="line-14">
</div><div class="line-15">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">connectionsToRemove</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-16">            <span class="p">{</span>
</div><div class="line-17">                <span class="n">connections</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">connectionsToRemove</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</div><div class="line-18">            <span class="p">}</span>
</div><div class="line-19">
</div><div class="line-20">            <span class="n">connectionsToRemove</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</div><div class="line-21">        <span class="p">}</span>
</div><div class="line-22">
</div><div class="line-23">        <span class="n">nodes</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</div><div class="line-24">    <span class="p">}</span>
</div></code></pre></figure>
<h3 id="final-touches">Final Touches</h3>
<p>The node editor is complete at this point, but it lacks some important features which would elevate the user experience:</p>
<ul>
 <li>A draggable canvas,</li>
 <li>A bezier from selected connection point to the mouse position,</li>
 <li>A grid in the background.</li>
</ul>
<p>Making our canvas draggable is the easiest one, so let’s start with that. All we have to do is just apply mouse drag to every single node in the node list.</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">public</span> <span class="k">class</span> <span class="nc">NodeBasedEditor</span> <span class="p">:</span> <span class="n">EditorWindow</span>
</div><div class="line-2"><span class="p">{</span>
</div><div class="line-3">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">nodes</span><span class="p">;</span>
</div><div class="line-4">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;</span> <span class="n">connections</span><span class="p">;</span>
</div><div class="line-5">
</div><div class="line-6">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-7">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">selectedNodeStyle</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">inPointStyle</span><span class="p">;</span>
</div><div class="line-9">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">outPointStyle</span><span class="p">;</span>
</div><div class="line-10">
</div><div class="line-11">    <span class="k">private</span> <span class="n">ConnectionPoint</span> <span class="n">selectedInPoint</span><span class="p">;</span>
</div><div class="line-12">    <span class="k">private</span> <span class="n">ConnectionPoint</span> <span class="n">selectedOutPoint</span><span class="p">;</span>
</div><div class="line-13">    
</div><div class="line-14">    <span class="k">private</span> <span class="n">Vector2</span> <span class="n">drag</span><span class="p">;</span>
</div><div class="line-15">
</div><div class="line-16">    <span class="p">...</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-2">    <span class="p">{</span>
</div><div class="line-3">        <span class="n">drag</span> <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5">        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-6">        <span class="p">{</span>
</div><div class="line-7">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">:</span>
</div><div class="line-8">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</div><div class="line-9">                <span class="p">{</span>
</div><div class="line-10">                    <span class="nf">ClearConnectionSelection</span><span class="p">();</span>
</div><div class="line-11">                <span class="p">}</span>
</div><div class="line-12">
</div><div class="line-13">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
</div><div class="line-14">                <span class="p">{</span>
</div><div class="line-15">                    <span class="nf">ProcessContextMenu</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">);</span>
</div><div class="line-16">                <span class="p">}</span>
</div><div class="line-17">            <span class="k">break</span><span class="p">;</span>
</div><div class="line-18">
</div><div class="line-19">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDrag</span><span class="p">:</span>
</div><div class="line-20">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</div><div class="line-21">                <span class="p">{</span>
</div><div class="line-22">                    <span class="nf">OnDrag</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">delta</span><span class="p">);</span>
</div><div class="line-23">                <span class="p">}</span>
</div><div class="line-24">            <span class="k">break</span><span class="p">;</span>
</div><div class="line-25">        <span class="p">}</span>
</div><div class="line-26">    <span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnDrag</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">delta</span><span class="p">)</span>
</div><div class="line-2">    <span class="p">{</span>
</div><div class="line-3">        <span class="n">drag</span> <span class="p">=</span> <span class="n">delta</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-6">        <span class="p">{</span>
</div><div class="line-7">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-8">            <span class="p">{</span>
</div><div class="line-9">                <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">Drag</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
</div><div class="line-10">            <span class="p">}</span>
</div><div class="line-11">        <span class="p">}</span>
</div><div class="line-12">
</div><div class="line-13">        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-14">    <span class="p">}</span>
</div></code></pre></figure>
<p>Next up, drawing the bezier from selected connection point to the mouse position. By drawing this bezier, we will let users know which connection point selected and how their connection will look like.</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">()</span>
</div><div class="line-2">    <span class="p">{</span>
</div><div class="line-3">        <span class="nf">DrawNodes</span><span class="p">();</span>
</div><div class="line-4">        <span class="nf">DrawConnections</span><span class="p">();</span>
</div><div class="line-5">
</div><div class="line-6">        <span class="nf">DrawConnectionLine</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-7">
</div><div class="line-8">        <span class="nf">ProcessNodeEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-9">        <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-10">
</div><div class="line-11">        <span class="k">if</span> <span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="n">changed</span><span class="p">)</span> <span class="nf">Repaint</span><span class="p">();</span>
</div><div class="line-12">    <span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawConnectionLine</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-2">    <span class="p">{</span>
</div><div class="line-3">        <span class="k">if</span> <span class="p">(</span><span class="n">selectedInPoint</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">selectedOutPoint</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-4">        <span class="p">{</span>
</div><div class="line-5">            <span class="n">Handles</span><span class="p">.</span><span class="nf">DrawBezier</span><span class="p">(</span>
</div><div class="line-6">                <span class="n">selectedInPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span><span class="p">,</span>
</div><div class="line-7">                <span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">,</span>
</div><div class="line-8">                <span class="n">selectedInPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-9">                <span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span> <span class="p">-</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-10">                <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span>
</div><div class="line-11">                <span class="k">null</span><span class="p">,</span>
</div><div class="line-12">                <span class="m">2f</span>
</div><div class="line-13">            <span class="p">);</span>
</div><div class="line-14">
</div><div class="line-15">            <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-16">        <span class="p">}</span>
</div><div class="line-17">
</div><div class="line-18">        <span class="k">if</span> <span class="p">(</span><span class="n">selectedOutPoint</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">selectedInPoint</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-19">        <span class="p">{</span>
</div><div class="line-20">            <span class="n">Handles</span><span class="p">.</span><span class="nf">DrawBezier</span><span class="p">(</span>
</div><div class="line-21">                <span class="n">selectedOutPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span><span class="p">,</span>
</div><div class="line-22">                <span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">,</span>
</div><div class="line-23">                <span class="n">selectedOutPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span> <span class="p">-</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-24">                <span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-25">                <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span>
</div><div class="line-26">                <span class="k">null</span><span class="p">,</span>
</div><div class="line-27">                <span class="m">2f</span>
</div><div class="line-28">            <span class="p">);</span>
</div><div class="line-29">
</div><div class="line-30">            <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-31">        <span class="p">}</span>
</div><div class="line-32">    <span class="p">}</span>
</div></code></pre></figure>
<p>And finally, drawing the grid:</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">public</span> <span class="k">class</span> <span class="nc">NodeBasedEditor</span> <span class="p">:</span> <span class="n">EditorWindow</span>
</div><div class="line-2"><span class="p">{</span>
</div><div class="line-3">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">nodes</span><span class="p">;</span>
</div><div class="line-4">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;</span> <span class="n">connections</span><span class="p">;</span>
</div><div class="line-5">
</div><div class="line-6">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-7">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">selectedNodeStyle</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">inPointStyle</span><span class="p">;</span>
</div><div class="line-9">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">outPointStyle</span><span class="p">;</span>
</div><div class="line-10">
</div><div class="line-11">    <span class="k">private</span> <span class="n">ConnectionPoint</span> <span class="n">selectedInPoint</span><span class="p">;</span>
</div><div class="line-12">    <span class="k">private</span> <span class="n">ConnectionPoint</span> <span class="n">selectedOutPoint</span><span class="p">;</span>
</div><div class="line-13">
</div><div class="line-14">    <span class="k">private</span> <span class="n">Vector2</span> <span class="n">offset</span><span class="p">;</span>
</div><div class="line-15">    <span class="k">private</span> <span class="n">Vector2</span> <span class="n">drag</span><span class="p">;</span>
</div><div class="line-16">
</div><div class="line-17">    <span class="p">...</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">()</span>
</div><div class="line-2">    <span class="p">{</span>
</div><div class="line-3">        <span class="nf">DrawGrid</span><span class="p">(</span><span class="m">20</span><span class="p">,</span> <span class="m">0.2f</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">gray</span><span class="p">);</span>
</div><div class="line-4">        <span class="nf">DrawGrid</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">0.4f</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">gray</span><span class="p">);</span>
</div><div class="line-5">
</div><div class="line-6">        <span class="nf">DrawNodes</span><span class="p">();</span>
</div><div class="line-7">        <span class="nf">DrawConnections</span><span class="p">();</span>
</div><div class="line-8">
</div><div class="line-9">        <span class="nf">DrawConnectionLine</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-10">
</div><div class="line-11">        <span class="nf">ProcessNodeEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-12">        <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-13">
</div><div class="line-14">        <span class="k">if</span> <span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="n">changed</span><span class="p">)</span> <span class="nf">Repaint</span><span class="p">();</span>
</div><div class="line-15">    <span class="p">}</span>
</div><div class="line-16">
</div><div class="line-17">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawGrid</span><span class="p">(</span><span class="kt">float</span> <span class="n">gridSpacing</span><span class="p">,</span> <span class="kt">float</span> <span class="n">gridOpacity</span><span class="p">,</span> <span class="n">Color</span> <span class="n">gridColor</span><span class="p">)</span>
</div><div class="line-18">    <span class="p">{</span>
</div><div class="line-19">        <span class="kt">int</span> <span class="n">widthDivs</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">CeilToInt</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">width</span> <span class="p">/</span> <span class="n">gridSpacing</span><span class="p">);</span>
</div><div class="line-20">        <span class="kt">int</span> <span class="n">heightDivs</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">CeilToInt</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">height</span> <span class="p">/</span> <span class="n">gridSpacing</span><span class="p">);</span>
</div><div class="line-21">
</div><div class="line-22">        <span class="n">Handles</span><span class="p">.</span><span class="nf">BeginGUI</span><span class="p">();</span>
</div><div class="line-23">        <span class="n">Handles</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Color</span><span class="p">(</span><span class="n">gridColor</span><span class="p">.</span><span class="n">r</span><span class="p">,</span> <span class="n">gridColor</span><span class="p">.</span><span class="n">g</span><span class="p">,</span> <span class="n">gridColor</span><span class="p">.</span><span class="n">b</span><span class="p">,</span> <span class="n">gridOpacity</span><span class="p">);</span>
</div><div class="line-24">
</div><div class="line-25">        <span class="n">offset</span> <span class="p">+=</span> <span class="n">drag</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">;</span>
</div><div class="line-26">        <span class="n">Vector3</span> <span class="n">newOffset</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">offset</span><span class="p">.</span><span class="n">x</span> <span class="p">%</span> <span class="n">gridSpacing</span><span class="p">,</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span> <span class="p">%</span> <span class="n">gridSpacing</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</div><div class="line-27">
</div><div class="line-28">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">widthDivs</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-29">        <span class="p">{</span>
</div><div class="line-30">            <span class="n">Handles</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">gridSpacing</span> <span class="p">*</span> <span class="n">i</span><span class="p">,</span> <span class="p">-</span><span class="n">gridSpacing</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span> <span class="p">+</span> <span class="n">newOffset</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">gridSpacing</span> <span class="p">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="m">0f</span><span class="p">)</span> <span class="p">+</span> <span class="n">newOffset</span><span class="p">);</span>
</div><div class="line-31">        <span class="p">}</span>
</div><div class="line-32">
</div><div class="line-33">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">heightDivs</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
</div><div class="line-34">        <span class="p">{</span>
</div><div class="line-35">            <span class="n">Handles</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(-</span><span class="n">gridSpacing</span><span class="p">,</span> <span class="n">gridSpacing</span> <span class="p">*</span> <span class="n">j</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span> <span class="p">+</span> <span class="n">newOffset</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">gridSpacing</span> <span class="p">*</span> <span class="n">j</span><span class="p">,</span> <span class="m">0f</span><span class="p">)</span> <span class="p">+</span> <span class="n">newOffset</span><span class="p">);</span>
</div><div class="line-36">        <span class="p">}</span>
</div><div class="line-37">
</div><div class="line-38">        <span class="n">Handles</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">;</span>
</div><div class="line-39">        <span class="n">Handles</span><span class="p">.</span><span class="nf">EndGUI</span><span class="p">();</span>
</div><div class="line-40">    <span class="p">}</span>
</div></code></pre></figure>
<h3 id="conclusion">Conclusion</h3>
<p>This concludes our tutorial and to be frank, our node editor looks like any first grade node editor you can find on the Asset Store. From this point on, you can work on it and create your own custom node editor. Here is a quest editor I built while working on a prototype:</p>
<div class="img-wrapper">
        <img src="/assets/img/sample-node-based-editor.png" class="center" alt="Sample Node Based Editor" width="400px" />
   <div class="empty-caption"></div>
</div>
<p>And as always, here is the script in full, below. Until next time.</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">NodeBasedEditor</span> <span class="p">:</span> <span class="n">EditorWindow</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">nodes</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;</span> <span class="n">connections</span><span class="p">;</span>
</div><div class="line-9">
</div><div class="line-10">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-11">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">selectedNodeStyle</span><span class="p">;</span>
</div><div class="line-12">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">inPointStyle</span><span class="p">;</span>
</div><div class="line-13">    <span class="k">private</span> <span class="n">GUIStyle</span> <span class="n">outPointStyle</span><span class="p">;</span>
</div><div class="line-14">
</div><div class="line-15">    <span class="k">private</span> <span class="n">ConnectionPoint</span> <span class="n">selectedInPoint</span><span class="p">;</span>
</div><div class="line-16">    <span class="k">private</span> <span class="n">ConnectionPoint</span> <span class="n">selectedOutPoint</span><span class="p">;</span>
</div><div class="line-17">
</div><div class="line-18">    <span class="k">private</span> <span class="n">Vector2</span> <span class="n">offset</span><span class="p">;</span>
</div><div class="line-19">    <span class="k">private</span> <span class="n">Vector2</span> <span class="n">drag</span><span class="p">;</span>
</div><div class="line-20">
</div><div class="line-21">    <span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"Window/Node Based Editor"</span><span class="p">)]</span>
</div><div class="line-22">    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">OpenWindow</span><span class="p">()</span>
</div><div class="line-23">    <span class="p">{</span>
</div><div class="line-24">        <span class="n">NodeBasedEditor</span> <span class="n">window</span> <span class="p">=</span> <span class="n">GetWindow</span><span class="p">&lt;</span><span class="n">NodeBasedEditor</span><span class="p">&gt;();</span>
</div><div class="line-25">        <span class="n">window</span><span class="p">.</span><span class="n">titleContent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Node Based Editor"</span><span class="p">);</span>
</div><div class="line-26">    <span class="p">}</span>
</div><div class="line-27">
</div><div class="line-28">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnEnable</span><span class="p">()</span>
</div><div class="line-29">    <span class="p">{</span>
</div><div class="line-30">        <span class="n">nodeStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-31">        <span class="n">nodeStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/node1.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-32">        <span class="n">nodeStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-33">
</div><div class="line-34">        <span class="n">selectedNodeStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-35">        <span class="n">selectedNodeStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/node1 on.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-36">        <span class="n">selectedNodeStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-37">
</div><div class="line-38">        <span class="n">inPointStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-39">        <span class="n">inPointStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn left.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-40">        <span class="n">inPointStyle</span><span class="p">.</span><span class="n">active</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn left on.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-41">        <span class="n">inPointStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-42">
</div><div class="line-43">        <span class="n">outPointStyle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GUIStyle</span><span class="p">();</span>
</div><div class="line-44">        <span class="n">outPointStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn right.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-45">        <span class="n">outPointStyle</span><span class="p">.</span><span class="n">active</span><span class="p">.</span><span class="n">background</span> <span class="p">=</span> <span class="n">EditorGUIUtility</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"builtin skins/darkskin/images/btn right on.png"</span><span class="p">)</span> <span class="k">as</span> <span class="n">Texture2D</span><span class="p">;</span>
</div><div class="line-46">        <span class="n">outPointStyle</span><span class="p">.</span><span class="n">border</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectOffset</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
</div><div class="line-47">    <span class="p">}</span>
</div><div class="line-48">
</div><div class="line-49">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">()</span>
</div><div class="line-50">    <span class="p">{</span>
</div><div class="line-51">        <span class="nf">DrawGrid</span><span class="p">(</span><span class="m">20</span><span class="p">,</span> <span class="m">0.2f</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">gray</span><span class="p">);</span>
</div><div class="line-52">        <span class="nf">DrawGrid</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">0.4f</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">gray</span><span class="p">);</span>
</div><div class="line-53">
</div><div class="line-54">        <span class="nf">DrawNodes</span><span class="p">();</span>
</div><div class="line-55">        <span class="nf">DrawConnections</span><span class="p">();</span>
</div><div class="line-56">
</div><div class="line-57">        <span class="nf">DrawConnectionLine</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-58">
</div><div class="line-59">        <span class="nf">ProcessNodeEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-60">        <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">current</span><span class="p">);</span>
</div><div class="line-61">
</div><div class="line-62">        <span class="k">if</span> <span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="n">changed</span><span class="p">)</span> <span class="nf">Repaint</span><span class="p">();</span>
</div><div class="line-63">    <span class="p">}</span>
</div><div class="line-64">
</div><div class="line-65">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawGrid</span><span class="p">(</span><span class="kt">float</span> <span class="n">gridSpacing</span><span class="p">,</span> <span class="kt">float</span> <span class="n">gridOpacity</span><span class="p">,</span> <span class="n">Color</span> <span class="n">gridColor</span><span class="p">)</span>
</div><div class="line-66">    <span class="p">{</span>
</div><div class="line-67">        <span class="kt">int</span> <span class="n">widthDivs</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">CeilToInt</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">width</span> <span class="p">/</span> <span class="n">gridSpacing</span><span class="p">);</span>
</div><div class="line-68">        <span class="kt">int</span> <span class="n">heightDivs</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">CeilToInt</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">height</span> <span class="p">/</span> <span class="n">gridSpacing</span><span class="p">);</span>
</div><div class="line-69">
</div><div class="line-70">        <span class="n">Handles</span><span class="p">.</span><span class="nf">BeginGUI</span><span class="p">();</span>
</div><div class="line-71">        <span class="n">Handles</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Color</span><span class="p">(</span><span class="n">gridColor</span><span class="p">.</span><span class="n">r</span><span class="p">,</span> <span class="n">gridColor</span><span class="p">.</span><span class="n">g</span><span class="p">,</span> <span class="n">gridColor</span><span class="p">.</span><span class="n">b</span><span class="p">,</span> <span class="n">gridOpacity</span><span class="p">);</span>
</div><div class="line-72">
</div><div class="line-73">        <span class="n">offset</span> <span class="p">+=</span> <span class="n">drag</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">;</span>
</div><div class="line-74">        <span class="n">Vector3</span> <span class="n">newOffset</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">offset</span><span class="p">.</span><span class="n">x</span> <span class="p">%</span> <span class="n">gridSpacing</span><span class="p">,</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span> <span class="p">%</span> <span class="n">gridSpacing</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</div><div class="line-75">
</div><div class="line-76">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">widthDivs</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-77">        <span class="p">{</span>
</div><div class="line-78">            <span class="n">Handles</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">gridSpacing</span> <span class="p">*</span> <span class="n">i</span><span class="p">,</span> <span class="p">-</span><span class="n">gridSpacing</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span> <span class="p">+</span> <span class="n">newOffset</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">gridSpacing</span> <span class="p">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="m">0f</span><span class="p">)</span> <span class="p">+</span> <span class="n">newOffset</span><span class="p">);</span>
</div><div class="line-79">        <span class="p">}</span>
</div><div class="line-80">
</div><div class="line-81">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">heightDivs</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
</div><div class="line-82">        <span class="p">{</span>
</div><div class="line-83">            <span class="n">Handles</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(-</span><span class="n">gridSpacing</span><span class="p">,</span> <span class="n">gridSpacing</span> <span class="p">*</span> <span class="n">j</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span> <span class="p">+</span> <span class="n">newOffset</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">gridSpacing</span> <span class="p">*</span> <span class="n">j</span><span class="p">,</span> <span class="m">0f</span><span class="p">)</span> <span class="p">+</span> <span class="n">newOffset</span><span class="p">);</span>
</div><div class="line-84">        <span class="p">}</span>
</div><div class="line-85">
</div><div class="line-86">        <span class="n">Handles</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">;</span>
</div><div class="line-87">        <span class="n">Handles</span><span class="p">.</span><span class="nf">EndGUI</span><span class="p">();</span>
</div><div class="line-88">    <span class="p">}</span>
</div><div class="line-89">
</div><div class="line-90">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawNodes</span><span class="p">()</span>
</div><div class="line-91">    <span class="p">{</span>
</div><div class="line-92">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-93">        <span class="p">{</span>
</div><div class="line-94">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-95">            <span class="p">{</span>
</div><div class="line-96">                <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-97">            <span class="p">}</span>
</div><div class="line-98">        <span class="p">}</span>
</div><div class="line-99">    <span class="p">}</span>
</div><div class="line-100">
</div><div class="line-101">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawConnections</span><span class="p">()</span>
</div><div class="line-102">    <span class="p">{</span>
</div><div class="line-103">        <span class="k">if</span> <span class="p">(</span><span class="n">connections</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-104">        <span class="p">{</span>
</div><div class="line-105">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">connections</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-106">            <span class="p">{</span>
</div><div class="line-107">                <span class="n">connections</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-108">            <span class="p">}</span> 
</div><div class="line-109">        <span class="p">}</span>
</div><div class="line-110">    <span class="p">}</span>
</div><div class="line-111">
</div><div class="line-112">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-113">    <span class="p">{</span>
</div><div class="line-114">        <span class="n">drag</span> <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
</div><div class="line-115">
</div><div class="line-116">        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-117">        <span class="p">{</span>
</div><div class="line-118">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">:</span>
</div><div class="line-119">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</div><div class="line-120">                <span class="p">{</span>
</div><div class="line-121">                    <span class="nf">ClearConnectionSelection</span><span class="p">();</span>
</div><div class="line-122">                <span class="p">}</span>
</div><div class="line-123">
</div><div class="line-124">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
</div><div class="line-125">                <span class="p">{</span>
</div><div class="line-126">                    <span class="nf">ProcessContextMenu</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">);</span>
</div><div class="line-127">                <span class="p">}</span>
</div><div class="line-128">            <span class="k">break</span><span class="p">;</span>
</div><div class="line-129">
</div><div class="line-130">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDrag</span><span class="p">:</span>
</div><div class="line-131">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</div><div class="line-132">                <span class="p">{</span>
</div><div class="line-133">                    <span class="nf">OnDrag</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">delta</span><span class="p">);</span>
</div><div class="line-134">                <span class="p">}</span>
</div><div class="line-135">            <span class="k">break</span><span class="p">;</span>
</div><div class="line-136">        <span class="p">}</span>
</div><div class="line-137">    <span class="p">}</span>
</div><div class="line-138">
</div><div class="line-139">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessNodeEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-140">    <span class="p">{</span>
</div><div class="line-141">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-142">        <span class="p">{</span>
</div><div class="line-143">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="n">nodes</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">--)</span>
</div><div class="line-144">            <span class="p">{</span>
</div><div class="line-145">                <span class="kt">bool</span> <span class="n">guiChanged</span> <span class="p">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</div><div class="line-146">
</div><div class="line-147">                <span class="k">if</span> <span class="p">(</span><span class="n">guiChanged</span><span class="p">)</span>
</div><div class="line-148">                <span class="p">{</span>
</div><div class="line-149">                    <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-150">                <span class="p">}</span>
</div><div class="line-151">            <span class="p">}</span>
</div><div class="line-152">        <span class="p">}</span>
</div><div class="line-153">    <span class="p">}</span>
</div><div class="line-154">
</div><div class="line-155">    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawConnectionLine</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-156">    <span class="p">{</span>
</div><div class="line-157">        <span class="k">if</span> <span class="p">(</span><span class="n">selectedInPoint</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">selectedOutPoint</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-158">        <span class="p">{</span>
</div><div class="line-159">            <span class="n">Handles</span><span class="p">.</span><span class="nf">DrawBezier</span><span class="p">(</span>
</div><div class="line-160">                <span class="n">selectedInPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span><span class="p">,</span>
</div><div class="line-161">                <span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">,</span>
</div><div class="line-162">                <span class="n">selectedInPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-163">                <span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span> <span class="p">-</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-164">                <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span>
</div><div class="line-165">                <span class="k">null</span><span class="p">,</span>
</div><div class="line-166">                <span class="m">2f</span>
</div><div class="line-167">            <span class="p">);</span>
</div><div class="line-168">
</div><div class="line-169">            <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-170">        <span class="p">}</span>
</div><div class="line-171">
</div><div class="line-172">        <span class="k">if</span> <span class="p">(</span><span class="n">selectedOutPoint</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">selectedInPoint</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-173">        <span class="p">{</span>
</div><div class="line-174">            <span class="n">Handles</span><span class="p">.</span><span class="nf">DrawBezier</span><span class="p">(</span>
</div><div class="line-175">                <span class="n">selectedOutPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span><span class="p">,</span>
</div><div class="line-176">                <span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">,</span>
</div><div class="line-177">                <span class="n">selectedOutPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span> <span class="p">-</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-178">                <span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-179">                <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span>
</div><div class="line-180">                <span class="k">null</span><span class="p">,</span>
</div><div class="line-181">                <span class="m">2f</span>
</div><div class="line-182">            <span class="p">);</span>
</div><div class="line-183">
</div><div class="line-184">            <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-185">        <span class="p">}</span>
</div><div class="line-186">    <span class="p">}</span>
</div><div class="line-187">
</div><div class="line-188">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessContextMenu</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">mousePosition</span><span class="p">)</span>
</div><div class="line-189">    <span class="p">{</span>
</div><div class="line-190">        <span class="n">GenericMenu</span> <span class="n">genericMenu</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GenericMenu</span><span class="p">();</span>
</div><div class="line-191">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">AddItem</span><span class="p">(</span><span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Add node"</span><span class="p">),</span> <span class="k">false</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nf">OnClickAddNode</span><span class="p">(</span><span class="n">mousePosition</span><span class="p">));</span> 
</div><div class="line-192">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">ShowAsContext</span><span class="p">();</span>
</div><div class="line-193">    <span class="p">}</span>
</div><div class="line-194">
</div><div class="line-195">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnDrag</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">delta</span><span class="p">)</span>
</div><div class="line-196">    <span class="p">{</span>
</div><div class="line-197">        <span class="n">drag</span> <span class="p">=</span> <span class="n">delta</span><span class="p">;</span>
</div><div class="line-198">
</div><div class="line-199">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-200">        <span class="p">{</span>
</div><div class="line-201">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-202">            <span class="p">{</span>
</div><div class="line-203">                <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">Drag</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
</div><div class="line-204">            <span class="p">}</span>
</div><div class="line-205">        <span class="p">}</span>
</div><div class="line-206">
</div><div class="line-207">        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-208">    <span class="p">}</span>
</div><div class="line-209">
</div><div class="line-210">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickAddNode</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">mousePosition</span><span class="p">)</span>
</div><div class="line-211">    <span class="p">{</span>
</div><div class="line-212">        <span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-213">        <span class="p">{</span>
</div><div class="line-214">            <span class="n">nodes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;();</span>
</div><div class="line-215">        <span class="p">}</span>
</div><div class="line-216">
</div><div class="line-217">        <span class="n">nodes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Node</span><span class="p">(</span><span class="n">mousePosition</span><span class="p">,</span> <span class="m">200</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="n">nodeStyle</span><span class="p">,</span> <span class="n">selectedNodeStyle</span><span class="p">,</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">OnClickInPoint</span><span class="p">,</span> <span class="n">OnClickOutPoint</span><span class="p">,</span> <span class="n">OnClickRemoveNode</span><span class="p">));</span>
</div><div class="line-218">    <span class="p">}</span>
</div><div class="line-219">
</div><div class="line-220">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickInPoint</span><span class="p">(</span><span class="n">ConnectionPoint</span> <span class="n">inPoint</span><span class="p">)</span>
</div><div class="line-221">    <span class="p">{</span>
</div><div class="line-222">        <span class="n">selectedInPoint</span> <span class="p">=</span> <span class="n">inPoint</span><span class="p">;</span>
</div><div class="line-223">
</div><div class="line-224">        <span class="k">if</span> <span class="p">(</span><span class="n">selectedOutPoint</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-225">        <span class="p">{</span>
</div><div class="line-226">            <span class="k">if</span> <span class="p">(</span><span class="n">selectedOutPoint</span><span class="p">.</span><span class="n">node</span> <span class="p">!=</span> <span class="n">selectedInPoint</span><span class="p">.</span><span class="n">node</span><span class="p">)</span>
</div><div class="line-227">            <span class="p">{</span>
</div><div class="line-228">                <span class="nf">CreateConnection</span><span class="p">();</span>
</div><div class="line-229">                <span class="nf">ClearConnectionSelection</span><span class="p">();</span> 
</div><div class="line-230">            <span class="p">}</span>
</div><div class="line-231">            <span class="k">else</span>
</div><div class="line-232">            <span class="p">{</span>
</div><div class="line-233">                <span class="nf">ClearConnectionSelection</span><span class="p">();</span>
</div><div class="line-234">            <span class="p">}</span>
</div><div class="line-235">        <span class="p">}</span>
</div><div class="line-236">    <span class="p">}</span>
</div><div class="line-237">
</div><div class="line-238">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickOutPoint</span><span class="p">(</span><span class="n">ConnectionPoint</span> <span class="n">outPoint</span><span class="p">)</span>
</div><div class="line-239">    <span class="p">{</span>
</div><div class="line-240">        <span class="n">selectedOutPoint</span> <span class="p">=</span> <span class="n">outPoint</span><span class="p">;</span>
</div><div class="line-241">
</div><div class="line-242">        <span class="k">if</span> <span class="p">(</span><span class="n">selectedInPoint</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-243">        <span class="p">{</span>
</div><div class="line-244">            <span class="k">if</span> <span class="p">(</span><span class="n">selectedOutPoint</span><span class="p">.</span><span class="n">node</span> <span class="p">!=</span> <span class="n">selectedInPoint</span><span class="p">.</span><span class="n">node</span><span class="p">)</span>
</div><div class="line-245">            <span class="p">{</span>
</div><div class="line-246">                <span class="nf">CreateConnection</span><span class="p">();</span>
</div><div class="line-247">                <span class="nf">ClearConnectionSelection</span><span class="p">();</span>
</div><div class="line-248">            <span class="p">}</span>
</div><div class="line-249">            <span class="k">else</span>
</div><div class="line-250">            <span class="p">{</span>
</div><div class="line-251">                <span class="nf">ClearConnectionSelection</span><span class="p">();</span>
</div><div class="line-252">            <span class="p">}</span>
</div><div class="line-253">        <span class="p">}</span>
</div><div class="line-254">    <span class="p">}</span>
</div><div class="line-255">
</div><div class="line-256">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickRemoveNode</span><span class="p">(</span><span class="n">Node</span> <span class="n">node</span><span class="p">)</span>
</div><div class="line-257">    <span class="p">{</span>
</div><div class="line-258">        <span class="k">if</span> <span class="p">(</span><span class="n">connections</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-259">        <span class="p">{</span>
</div><div class="line-260">            <span class="n">List</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;</span> <span class="n">connectionsToRemove</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;();</span>
</div><div class="line-261">
</div><div class="line-262">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">connections</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-263">            <span class="p">{</span>
</div><div class="line-264">                <span class="k">if</span> <span class="p">(</span><span class="n">connections</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">inPoint</span> <span class="p">==</span> <span class="n">node</span><span class="p">.</span><span class="n">inPoint</span> <span class="p">||</span> <span class="n">connections</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">outPoint</span> <span class="p">==</span> <span class="n">node</span><span class="p">.</span><span class="n">outPoint</span><span class="p">)</span>
</div><div class="line-265">                <span class="p">{</span>
</div><div class="line-266">                    <span class="n">connectionsToRemove</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">connections</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</div><div class="line-267">                <span class="p">}</span>
</div><div class="line-268">            <span class="p">}</span>
</div><div class="line-269">
</div><div class="line-270">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">connectionsToRemove</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</div><div class="line-271">            <span class="p">{</span>
</div><div class="line-272">                <span class="n">connections</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">connectionsToRemove</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</div><div class="line-273">            <span class="p">}</span>
</div><div class="line-274">
</div><div class="line-275">            <span class="n">connectionsToRemove</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</div><div class="line-276">        <span class="p">}</span>
</div><div class="line-277">
</div><div class="line-278">        <span class="n">nodes</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</div><div class="line-279">    <span class="p">}</span>
</div><div class="line-280">
</div><div class="line-281">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickRemoveConnection</span><span class="p">(</span><span class="n">Connection</span> <span class="n">connection</span><span class="p">)</span>
</div><div class="line-282">    <span class="p">{</span>
</div><div class="line-283">        <span class="n">connections</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">connection</span><span class="p">);</span>
</div><div class="line-284">    <span class="p">}</span>
</div><div class="line-285">
</div><div class="line-286">    <span class="k">private</span> <span class="k">void</span> <span class="nf">CreateConnection</span><span class="p">()</span>
</div><div class="line-287">    <span class="p">{</span>
</div><div class="line-288">        <span class="k">if</span> <span class="p">(</span><span class="n">connections</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-289">        <span class="p">{</span>
</div><div class="line-290">            <span class="n">connections</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;();</span>
</div><div class="line-291">        <span class="p">}</span>
</div><div class="line-292">
</div><div class="line-293">        <span class="n">connections</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Connection</span><span class="p">(</span><span class="n">selectedInPoint</span><span class="p">,</span> <span class="n">selectedOutPoint</span><span class="p">,</span> <span class="n">OnClickRemoveConnection</span><span class="p">));</span>
</div><div class="line-294">    <span class="p">}</span>
</div><div class="line-295">
</div><div class="line-296">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ClearConnectionSelection</span><span class="p">()</span>
</div><div class="line-297">    <span class="p">{</span>
</div><div class="line-298">        <span class="n">selectedInPoint</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</div><div class="line-299">        <span class="n">selectedOutPoint</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</div><div class="line-300">    <span class="p">}</span>
</div><div class="line-301"><span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">Node</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">public</span> <span class="n">Rect</span> <span class="n">rect</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">public</span> <span class="kt">string</span> <span class="n">title</span><span class="p">;</span>
</div><div class="line-9">    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isDragged</span><span class="p">;</span>
</div><div class="line-10">    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isSelected</span><span class="p">;</span>
</div><div class="line-11">
</div><div class="line-12">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">inPoint</span><span class="p">;</span>
</div><div class="line-13">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">outPoint</span><span class="p">;</span>
</div><div class="line-14">
</div><div class="line-15">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">style</span><span class="p">;</span>
</div><div class="line-16">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">defaultNodeStyle</span><span class="p">;</span>
</div><div class="line-17">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">selectedNodeStyle</span><span class="p">;</span>
</div><div class="line-18">
</div><div class="line-19">    <span class="k">public</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">OnRemoveNode</span><span class="p">;</span>
</div><div class="line-20">
</div><div class="line-21">    <span class="k">public</span> <span class="nf">Node</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">position</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width</span><span class="p">,</span> <span class="kt">float</span> <span class="n">height</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">nodeStyle</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">selectedStyle</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickInPoint</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickOutPoint</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Node</span><span class="p">&gt;</span> <span class="n">OnClickRemoveNode</span><span class="p">)</span>
</div><div class="line-22">    <span class="p">{</span>
</div><div class="line-23">        <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
</div><div class="line-24">        <span class="n">style</span> <span class="p">=</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-25">        <span class="n">inPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionPoint</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">In</span><span class="p">,</span> <span class="n">inPointStyle</span><span class="p">,</span> <span class="n">OnClickInPoint</span><span class="p">);</span>
</div><div class="line-26">        <span class="n">outPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionPoint</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">Out</span><span class="p">,</span> <span class="n">outPointStyle</span><span class="p">,</span> <span class="n">OnClickOutPoint</span><span class="p">);</span>
</div><div class="line-27">        <span class="n">defaultNodeStyle</span> <span class="p">=</span> <span class="n">nodeStyle</span><span class="p">;</span>
</div><div class="line-28">        <span class="n">selectedNodeStyle</span> <span class="p">=</span> <span class="n">selectedStyle</span><span class="p">;</span>
</div><div class="line-29">        <span class="n">OnRemoveNode</span> <span class="p">=</span> <span class="n">OnClickRemoveNode</span><span class="p">;</span>
</div><div class="line-30">    <span class="p">}</span>
</div><div class="line-31">
</div><div class="line-32">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Drag</span><span class="p">(</span><span class="n">Vector2</span> <span class="n">delta</span><span class="p">)</span>
</div><div class="line-33">    <span class="p">{</span>
</div><div class="line-34">        <span class="n">rect</span><span class="p">.</span><span class="n">position</span> <span class="p">+=</span> <span class="n">delta</span><span class="p">;</span>
</div><div class="line-35">    <span class="p">}</span>
</div><div class="line-36">
</div><div class="line-37">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Draw</span><span class="p">()</span>
</div><div class="line-38">    <span class="p">{</span>
</div><div class="line-39">        <span class="n">inPoint</span><span class="p">.</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-40">        <span class="n">outPoint</span><span class="p">.</span><span class="nf">Draw</span><span class="p">();</span>
</div><div class="line-41">        <span class="n">GUI</span><span class="p">.</span><span class="nf">Box</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">style</span><span class="p">);</span>
</div><div class="line-42">    <span class="p">}</span>
</div><div class="line-43">
</div><div class="line-44">    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">ProcessEvents</span><span class="p">(</span><span class="n">Event</span> <span class="n">e</span><span class="p">)</span>
</div><div class="line-45">    <span class="p">{</span>
</div><div class="line-46">        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-47">        <span class="p">{</span>
</div><div class="line-48">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">:</span>
</div><div class="line-49">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</div><div class="line-50">                <span class="p">{</span>
</div><div class="line-51">                    <span class="k">if</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">))</span>
</div><div class="line-52">                    <span class="p">{</span>
</div><div class="line-53">                        <span class="n">isDragged</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-54">                        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-55">                        <span class="n">isSelected</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-56">                        <span class="n">style</span> <span class="p">=</span> <span class="n">selectedNodeStyle</span><span class="p">;</span>
</div><div class="line-57">                    <span class="p">}</span>
</div><div class="line-58">                    <span class="k">else</span>
</div><div class="line-59">                    <span class="p">{</span>
</div><div class="line-60">                        <span class="n">GUI</span><span class="p">.</span><span class="n">changed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-61">                        <span class="n">isSelected</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-62">                        <span class="n">style</span> <span class="p">=</span> <span class="n">defaultNodeStyle</span><span class="p">;</span>
</div><div class="line-63">                    <span class="p">}</span>
</div><div class="line-64">                <span class="p">}</span>
</div><div class="line-65">
</div><div class="line-66">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">1</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">isSelected</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">rect</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">))</span>
</div><div class="line-67">                <span class="p">{</span>
</div><div class="line-68">                    <span class="nf">ProcessContextMenu</span><span class="p">();</span>
</div><div class="line-69">                    <span class="n">e</span><span class="p">.</span><span class="nf">Use</span><span class="p">();</span>
</div><div class="line-70">                <span class="p">}</span>
</div><div class="line-71">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-72">
</div><div class="line-73">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseUp</span><span class="p">:</span>
</div><div class="line-74">                <span class="n">isDragged</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-75">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-76">
</div><div class="line-77">            <span class="k">case</span> <span class="n">EventType</span><span class="p">.</span><span class="n">MouseDrag</span><span class="p">:</span>
</div><div class="line-78">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">button</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">isDragged</span><span class="p">)</span>
</div><div class="line-79">                <span class="p">{</span>
</div><div class="line-80">                    <span class="nf">Drag</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">delta</span><span class="p">);</span>
</div><div class="line-81">                    <span class="n">e</span><span class="p">.</span><span class="nf">Use</span><span class="p">();</span>
</div><div class="line-82">                    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</div><div class="line-83">                <span class="p">}</span>
</div><div class="line-84">                <span class="k">break</span><span class="p">;</span>
</div><div class="line-85">        <span class="p">}</span>
</div><div class="line-86">
</div><div class="line-87">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</div><div class="line-88">    <span class="p">}</span>
</div><div class="line-89">
</div><div class="line-90">    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessContextMenu</span><span class="p">()</span>
</div><div class="line-91">    <span class="p">{</span>
</div><div class="line-92">        <span class="n">GenericMenu</span> <span class="n">genericMenu</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GenericMenu</span><span class="p">();</span>
</div><div class="line-93">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">AddItem</span><span class="p">(</span><span class="k">new</span> <span class="nf">GUIContent</span><span class="p">(</span><span class="s">"Remove node"</span><span class="p">),</span> <span class="k">false</span><span class="p">,</span> <span class="n">OnClickRemoveNode</span><span class="p">);</span>
</div><div class="line-94">        <span class="n">genericMenu</span><span class="p">.</span><span class="nf">ShowAsContext</span><span class="p">();</span>
</div><div class="line-95">    <span class="p">}</span>
</div><div class="line-96">
</div><div class="line-97">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClickRemoveNode</span><span class="p">()</span>
</div><div class="line-98">    <span class="p">{</span>
</div><div class="line-99">        <span class="k">if</span> <span class="p">(</span><span class="n">OnRemoveNode</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-100">        <span class="p">{</span>
</div><div class="line-101">            <span class="nf">OnRemoveNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</div><div class="line-102">        <span class="p">}</span>
</div><div class="line-103">    <span class="p">}</span>
</div><div class="line-104"><span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
</div><div class="line-3"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-4">
</div><div class="line-5"><span class="k">public</span> <span class="k">class</span> <span class="nc">Connection</span>
</div><div class="line-6"><span class="p">{</span>
</div><div class="line-7">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">inPoint</span><span class="p">;</span>
</div><div class="line-8">    <span class="k">public</span> <span class="n">ConnectionPoint</span> <span class="n">outPoint</span><span class="p">;</span>
</div><div class="line-9">    <span class="k">public</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;</span> <span class="n">OnClickRemoveConnection</span><span class="p">;</span>
</div><div class="line-10">
</div><div class="line-11">    <span class="k">public</span> <span class="nf">Connection</span><span class="p">(</span><span class="n">ConnectionPoint</span> <span class="n">inPoint</span><span class="p">,</span> <span class="n">ConnectionPoint</span> <span class="n">outPoint</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Connection</span><span class="p">&gt;</span> <span class="n">OnClickRemoveConnection</span><span class="p">)</span>
</div><div class="line-12">    <span class="p">{</span>
</div><div class="line-13">        <span class="k">this</span><span class="p">.</span><span class="n">inPoint</span> <span class="p">=</span> <span class="n">inPoint</span><span class="p">;</span>
</div><div class="line-14">        <span class="k">this</span><span class="p">.</span><span class="n">outPoint</span> <span class="p">=</span> <span class="n">outPoint</span><span class="p">;</span>
</div><div class="line-15">        <span class="k">this</span><span class="p">.</span><span class="n">OnClickRemoveConnection</span> <span class="p">=</span> <span class="n">OnClickRemoveConnection</span><span class="p">;</span>
</div><div class="line-16">    <span class="p">}</span>
</div><div class="line-17">
</div><div class="line-18">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Draw</span><span class="p">()</span>
</div><div class="line-19">    <span class="p">{</span>
</div><div class="line-20">        <span class="n">Handles</span><span class="p">.</span><span class="nf">DrawBezier</span><span class="p">(</span>
</div><div class="line-21">            <span class="n">inPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span><span class="p">,</span>
</div><div class="line-22">            <span class="n">outPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span><span class="p">,</span>
</div><div class="line-23">            <span class="n">inPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span> <span class="p">+</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-24">            <span class="n">outPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span> <span class="p">-</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">left</span> <span class="p">*</span> <span class="m">50f</span><span class="p">,</span>
</div><div class="line-25">            <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span>
</div><div class="line-26">            <span class="k">null</span><span class="p">,</span>
</div><div class="line-27">            <span class="m">2f</span>
</div><div class="line-28">        <span class="p">);</span>
</div><div class="line-29">
</div><div class="line-30">        <span class="k">if</span> <span class="p">(</span><span class="n">Handles</span><span class="p">.</span><span class="nf">Button</span><span class="p">((</span><span class="n">inPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span> <span class="p">+</span> <span class="n">outPoint</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">center</span><span class="p">)</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">.</span><span class="n">identity</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="n">Handles</span><span class="p">.</span><span class="n">RectangleCap</span><span class="p">))</span>
</div><div class="line-31">        <span class="p">{</span>
</div><div class="line-32">            <span class="k">if</span> <span class="p">(</span><span class="n">OnClickRemoveConnection</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-33">            <span class="p">{</span>
</div><div class="line-34">                <span class="nf">OnClickRemoveConnection</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</div><div class="line-35">            <span class="p">}</span>
</div><div class="line-36">        <span class="p">}</span>
</div><div class="line-37">    <span class="p">}</span>
</div><div class="line-38"><span class="p">}</span>
</div></code></pre></figure>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><div class="line-1"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</div><div class="line-2"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</div><div class="line-3">
</div><div class="line-4"><span class="k">public</span> <span class="k">enum</span> <span class="n">ConnectionPointType</span> <span class="p">{</span> <span class="n">In</span><span class="p">,</span> <span class="n">Out</span> <span class="p">}</span>
</div><div class="line-5">
</div><div class="line-6"><span class="k">public</span> <span class="k">class</span> <span class="nc">ConnectionPoint</span>
</div><div class="line-7"><span class="p">{</span>
</div><div class="line-8">    <span class="k">public</span> <span class="n">Rect</span> <span class="n">rect</span><span class="p">;</span>
</div><div class="line-9">
</div><div class="line-10">    <span class="k">public</span> <span class="n">ConnectionPointType</span> <span class="n">type</span><span class="p">;</span>
</div><div class="line-11">
</div><div class="line-12">    <span class="k">public</span> <span class="n">Node</span> <span class="n">node</span><span class="p">;</span>
</div><div class="line-13">
</div><div class="line-14">    <span class="k">public</span> <span class="n">GUIStyle</span> <span class="n">style</span><span class="p">;</span>
</div><div class="line-15">
</div><div class="line-16">    <span class="k">public</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickConnectionPoint</span><span class="p">;</span>
</div><div class="line-17">
</div><div class="line-18">    <span class="k">public</span> <span class="nf">ConnectionPoint</span><span class="p">(</span><span class="n">Node</span> <span class="n">node</span><span class="p">,</span> <span class="n">ConnectionPointType</span> <span class="n">type</span><span class="p">,</span> <span class="n">GUIStyle</span> <span class="n">style</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ConnectionPoint</span><span class="p">&gt;</span> <span class="n">OnClickConnectionPoint</span><span class="p">)</span>
</div><div class="line-19">    <span class="p">{</span>
</div><div class="line-20">        <span class="k">this</span><span class="p">.</span><span class="n">node</span> <span class="p">=</span> <span class="n">node</span><span class="p">;</span>
</div><div class="line-21">        <span class="k">this</span><span class="p">.</span><span class="n">type</span> <span class="p">=</span> <span class="n">type</span><span class="p">;</span>
</div><div class="line-22">        <span class="k">this</span><span class="p">.</span><span class="n">style</span> <span class="p">=</span> <span class="n">style</span><span class="p">;</span>
</div><div class="line-23">        <span class="k">this</span><span class="p">.</span><span class="n">OnClickConnectionPoint</span> <span class="p">=</span> <span class="n">OnClickConnectionPoint</span><span class="p">;</span>
</div><div class="line-24">        <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">10f</span><span class="p">,</span> <span class="m">20f</span><span class="p">);</span>
</div><div class="line-25">    <span class="p">}</span>
</div><div class="line-26">
</div><div class="line-27">    <span class="k">public</span> <span class="k">void</span> <span class="nf">Draw</span><span class="p">()</span>
</div><div class="line-28">    <span class="p">{</span>
</div><div class="line-29">        <span class="n">rect</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="n">node</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">height</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">)</span> <span class="p">-</span> <span class="n">rect</span><span class="p">.</span><span class="n">height</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">;</span>
</div><div class="line-30">
</div><div class="line-31">        <span class="k">switch</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span>
</div><div class="line-32">        <span class="p">{</span>
</div><div class="line-33">            <span class="k">case</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">In</span><span class="p">:</span>
</div><div class="line-34">            <span class="n">rect</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="n">node</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span> <span class="p">-</span> <span class="n">rect</span><span class="p">.</span><span class="n">width</span> <span class="p">+</span> <span class="m">8f</span><span class="p">;</span>
</div><div class="line-35">            <span class="k">break</span><span class="p">;</span>
</div><div class="line-36">
</div><div class="line-37">            <span class="k">case</span> <span class="n">ConnectionPointType</span><span class="p">.</span><span class="n">Out</span><span class="p">:</span>
</div><div class="line-38">            <span class="n">rect</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="n">node</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span> <span class="p">+</span> <span class="n">node</span><span class="p">.</span><span class="n">rect</span><span class="p">.</span><span class="n">width</span> <span class="p">-</span> <span class="m">8f</span><span class="p">;</span>
</div><div class="line-39">            <span class="k">break</span><span class="p">;</span>
</div><div class="line-40">        <span class="p">}</span>
</div><div class="line-41">
</div><div class="line-42">        <span class="k">if</span> <span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">style</span><span class="p">))</span>
</div><div class="line-43">        <span class="p">{</span>
</div><div class="line-44">            <span class="k">if</span> <span class="p">(</span><span class="n">OnClickConnectionPoint</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</div><div class="line-45">            <span class="p">{</span>
</div><div class="line-46">                <span class="nf">OnClickConnectionPoint</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</div><div class="line-47">            <span class="p">}</span>
</div><div class="line-48">        <span class="p">}</span>
</div><div class="line-49">    <span class="p">}</span>
</div><div class="line-50"><span class="p">}</span>
</div></code></pre></figure>
 </div>
 <div class="post-footer">
<div class="post-filed">
 <p>
    Filed under
<a href="/category/unity/" rel="category">unity</a>,
<a href="/category/unity-editor/" rel="category">unity-editor</a>.
 </p>
 <p>
    <a href="#top">top&nbsp;&#8673;</a>
 </p>
</div>
<div class="post-nav">
 <p>
    <a href="/creating-clone-unitys-console-window/">&#8672;&nbsp;Creating a Clone of Unity's Console Window</a>
 </p>
 <p>
    <a href="/xml-serialization-and-deserialization-in-unity/">XML Serialization in Unity&nbsp;&#8674;</a>
 </p>
</div>
 </div>
 <div class="comments">
 </div>
</article>
   </div>
 </main>
 <footer class="site-footer">
 <div class="wrapper-footer">
   <div class="footer-col-wrapper">
      <a href="/">home</a>
      •
      <a href="https://github.com/oguzkonya/oguzkonya.github.io"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">github</span></a>
      •
      <a href="/feed.xml">rss</a>
   </div>
   <div class="copyright">
      © 2019 oguzkonya
   </div>
 </div>
  <script src="/assets/js/anchorize.js"></script>
</footer>
  <script src="/assets/js/instantpage.js" type="module" integrity="sha384-/IkE5iZAM/RxPto8B0nvKlMzIyCWtYocF01PbGGp1qElJuxv9J4whdWBRtzZltWn"></script>
  <script id="dsq-count-scr" src="//oguzkonya.disqus.com/count.js" async></script>
</body>
</html>
